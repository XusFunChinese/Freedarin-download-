<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, landscape=yes">
    <title>HSK 1 Master - XUSFUNCHINESE</title>
    <style>
        :root {
            --primary: #01579b; 
            --accent: #e1f5fe;  
            --gold: #fbc02d;
            --pinyin: #d0021b; 
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
        }
        
        body { 
            margin: 0; font-family: "Arial Black", "Segoe UI", Tahoma, sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: opacity 0.8s ease-out, visibility 0.8s; overflow: hidden;
        }

        .star {
            position: absolute; top: 50%; left: 50%; width: 2px; height: 2px;
            background: white; border-radius: 50%; box-shadow: 0 0 10px #fff;
            animation: shoot linear infinite;
        }

        @keyframes shoot {
            0% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(1000px); opacity: 0; width: 160px; }
        }

        .cover-content { text-align: center; z-index: 10; padding: 20px; }
        .cover-title { font-size: 7.5vw; color: white; line-height: 1.2; text-transform: uppercase; margin: 0; }
        .cover-subtitle { font-size: 10vw; color: var(--gold); margin-top: 5px; font-weight: 900; animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .click-hint { margin-top: 20px; color: white; font-size: 20px; opacity: 0.8; letter-spacing: 2px; }

        header { 
            background: rgba(255,255,255,0.95); padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; 
        }
        .header-left { display: flex; align-items: center; }
        .nav-btns button { 
            padding: 8px 12px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); 
            cursor: pointer; font-weight: bold; background: white; color: var(--primary);
        }
        .active-mode { background: var(--primary) !important; color: white !important; }
        .inline-watermark { margin-left: 15px; font-weight: 900; font-size: 18px; color: var(--primary); opacity: 0.5; border-left: 2px solid #ddd; padding-left: 15px; }

        main { flex: 1; display: flex; padding: 20px; gap: 15px; overflow: hidden; }
        #left-panel { flex: 1; background: rgba(255,255,255,0.95); border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid var(--accent); position: relative; }
        #right-panel { flex: 1.6; background: rgba(255,255,255,0.95); border-radius: 30px; padding: 30px; display: flex; flex-direction: column; overflow-y: auto; border: 4px solid var(--accent); position: relative; }

        ruby { ruby-align: center; font-size: 40px; margin: 0 4px; line-height: 2.2; font-weight: 600; }
        rt { font-size: 18px; color: var(--pinyin); font-weight: bold; }
        .eng-hint { display: block; font-size: 24px; color: #333; margin-top: 15px; border-top: 2px dashed #ccc; padding-top: 10px; font-style: italic; }
        #emoji-display { font-size: 120px; margin-bottom: 20px; }
        
        .option-btn { background: white; border: 2px solid var(--primary); padding: 15px; margin: 8px 0; border-radius: 15px; cursor: pointer; font-size: 20px; width: 100%; transition: 0.2s; }
        
        #scroll-view { display: none; width: 100%; overflow-y: auto; padding: 30px; background: white; border-radius: 30px; }
        .list-row { border-bottom: 1px solid var(--accent); padding: 15px; cursor: pointer; }
        .hidden { display: none !important; }
        #timer-display { font-size: 24px; color: #d32f2f; font-weight: bold; margin-right: 15px; }

        #result-screen { text-align: center; padding: 30px; width: 100%; }
        .result-score { font-size: 100px; color: var(--gold); margin: 10px 0; text-shadow: 2px 4px 10px rgba(0,0,0,0.1); }
        .subscribe-msg { font-size: 22px; color: var(--primary); font-weight: 900; margin-bottom: 40px; line-height: 1.4; }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div id="star-container"></div>
    <div class="cover-content">
        <h1 class="cover-title">50 MINI<br>DIALOGUES (1)</h1>
        <div class="cover-subtitle">HSK 1</div>
        <div class="click-hint">CLICK TO START</div>
    </div>
</div>

<header>
    <div class="header-left">
        <div class="nav-btns">
            <button onclick="setMode('study')" id="btn-study">ğŸ“– Study</button>
            <button onclick="setMode('review')" id="btn-review">ğŸ”„ Review</button>
            <button onclick="setMode('practice')" id="btn-practice">âœï¸ Practice</button>
            <button onclick="setMode('quiz')" id="btn-quiz">âš¡ Rush (30s)</button>
            <button onclick="setMode('list')" id="btn-list">ğŸ“œ Bank</button>
            <button onclick="setMode('wrong')" id="btn-wrong" style="border-color: #f44336; color: #f44336;">âŒ Mistake</button>
        </div>
        <div class="inline-watermark">XUSFUNCHINESE</div>
    </div>
    <div id="status-bar" style="display: flex; align-items: center;">
        <span id="timer-display" class="hidden">00:30</span>
        <span style="font-weight: bold; color: var(--primary);">Score: <span id="score-val">0</span></span>
    </div>
</header>

<main>
    <div id="main-ui" style="display: flex; width: 100%; gap: 15px;">
        <div id="left-panel">
            <div id="emoji-display">ğŸ‘‹</div>
            <button onclick="speakItem(true)" style="padding: 15px 40px; border-radius: 50px; cursor: pointer; background: var(--primary); color: white; border: none; font-weight: bold; font-size: 20px;">ğŸ”Š Audio</button>
        </div>
        <div id="right-panel">
            <div id="display-area"></div>
            <div id="hint-box" style="margin-top:20px; padding:15px; background:#fffde7; border-left:8px solid var(--gold); border-radius:12px;" class="hidden"></div>
            <div id="interaction-area" style="margin-top: 15px;"></div>
        </div>
    </div>
    <div id="scroll-view"></div>
</main>

<script>
    const database = [
        ["è®¤è¯†è·¯å—ï¼Ÿ", "rÃ¨n shi lÃ¹ ma ?", "Know the way?", "ğŸ—ºï¸", {cn: "è®¤è¯†ï¼Œè·Ÿæˆ‘èµ°ã€‚", py: "rÃ¨n shi , gÄ“n wÇ’ zÇ’u .", en: "Yes, follow me."}],
        ["ä¸€å…±å¤šå°‘é’±ï¼Ÿ", "yÃ­ gÃ²ng duÅ shao qiÃ¡n ?", "Total cost?", "ğŸ’´", {cn: "äº”åå—ã€‚", py: "wÇ” shÃ­ kuÃ i .", en: "50 RMB."}],
        ["å¯ä»¥æ‰“ç”µè¯å—ï¼Ÿ", "kÄ› yÇ dÇ diÃ n huÃ  ma ?", "Can I call?", "ğŸ“", {cn: "å¯ä»¥ã€‚", py: "kÄ› yÇ .", en: "Yes."}],
        ["é‚£æ˜¯ä½ çš„çŒ«å—ï¼Ÿ", "nÃ  shÃ¬ nÇ de mÄo ma ?", "Is that your cat?", "ğŸ±", {cn: "ä¸æ˜¯ï¼Œæˆ‘å§å§çš„ã€‚", py: "bÃº shÃ¬ , wÇ’ jiÄ› jie de .", en: "No, my sister's."}],
        ["æˆ‘ä»¬èµ°å§ï¼", "wÇ’ men zÇ’u ba !", "Let's go!", "ğŸƒ", {cn: "èµ°å§ã€‚", py: "zÇ’u ba .", en: "Let's go."}]
    ];

    let currentMode = 'study', currentIndex = 0, score = 0, timer = null;
    let wrongAnswers = [];
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playEffect(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'coin') {
            osc.frequency.setValueAtTime(987, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1318, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(220, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        }
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }

    function initStars() {
        const container = document.getElementById('star-container');
        for(let i=0; i<80; i++) {
            let s = document.createElement('div'); s.className = 'star';
            s.style.setProperty('--angle', Math.random() * 360 + 'deg');
            s.style.animationDuration = Math.random() * 1.5 + 0.8 + 's';
            container.appendChild(s);
        }
    }

    function enterApp() {
        document.getElementById('cover-page').style.opacity = '0';
        setTimeout(() => { document.getElementById('cover-page').style.visibility = 'hidden'; }, 800);
        setMode('study');
    }

    function speakText(text, callback = null) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(text);
        m.lang = 'zh-CN'; m.rate = 0.85;
        if (callback) m.onend = callback;
        window.speechSynthesis.speak(m);
    }

    function speakItem(fullMode = false) {
        const item = database[currentIndex];
        if (fullMode) speakText(item[0], () => setTimeout(() => speakText(item[4].cn), 400));
        else speakText(item[0]);
    }

    function setMode(m) {
        currentMode = m; currentIndex = 0; clearInterval(timer); score = 0;
        document.getElementById('score-val').innerText = "0";
        document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active-mode'));
        if(document.getElementById('btn-'+m)) document.getElementById('btn-'+m).classList.add('active-mode');
        document.getElementById('timer-display').classList.add('hidden');
        
        document.getElementById('right-panel').innerHTML = `<div id="display-area"></div><div id="hint-box" class="hidden"></div><div id="interaction-area"></div>`;

        if(m === 'list' || m === 'wrong') {
            document.getElementById('main-ui').classList.add('hidden');
            document.getElementById('scroll-view').style.display = 'block';
            if (m === 'list') renderList();
            else renderWrongBook();
        } else {
            document.getElementById('main-ui').classList.remove('hidden');
            document.getElementById('scroll-view').style.display = 'none';
            if (m === 'quiz') startRush();
            render();
        }
    }

    function startRush() {
        let timeLeft = 30;
        const display = document.getElementById('timer-display');
        display.classList.remove('hidden');
        timer = setInterval(() => {
            timeLeft--;
            display.innerText = `00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
            if (timeLeft <= 0) { clearInterval(timer); showFinalResult(); }
        }, 1000);
    }

    function showFinalResult() {
        const praises = ["å¤ªæ£’äº†ï¼", "å¹²å¾—æ¼‚äº®ï¼", "ä½ çœŸäº†ä¸èµ·ï¼"];
        speakText(praises[Math.floor(Math.random()*praises.length)]);
        document.getElementById('right-panel').innerHTML = `
            <div id="result-screen">
                <div class="result-score">${score}</div>
                <div class="subscribe-msg">Please subscribe to "Xu's Fun Chinese" on Youtube to learn more!</div>
                <button class="option-btn" onclick="setMode('study')" style="background:var(--primary); color:white; width:220px; margin: 0 auto;">Back to Study</button>
            </div>
        `;
    }

    function generateRubyHtml(text, pinyinStr) {
        const chars = text.split(''); const pys = pinyinStr.split(' ');
        let html = ""; let pyIdx = 0;
        chars.forEach(c => {
            if(/[\u4e00-\u9fa5]/.test(c)) {
                html += `<ruby>${c}<rt>${pys[pyIdx] || ''}</rt></ruby>`; pyIdx++;
            } else if (![' ', '!', '?', 'ï¼', 'ï¼Ÿ', '.', 'ã€‚', ','].includes(c)) {
                html += c; pyIdx++;
            } else html += c;
        });
        return html;
    }

    function render() {
        const item = database[currentIndex];
        const display = document.getElementById('display-area');
        const interaction = document.getElementById('interaction-area');
        const hint = document.getElementById('hint-box');
        
        document.getElementById('emoji-display').innerText = item[3];
        interaction.innerHTML = ""; 
        hint.className = 'hidden';
        hint.style = "margin-top:20px; padding:15px; background:#fffde7; border-left:8px solid var(--gold); border-radius:12px;";

        display.innerHTML = generateRubyHtml(item[0], item[1]) + `<span class="eng-hint">${item[2]}</span>`;

        if(currentMode === 'study' || currentMode === 'review') {
            hint.innerHTML = `<div style="font-size:26px; cursor:pointer;" onclick="speakText('${item[4].cn}')">${generateRubyHtml(item[4].cn, item[4].py)}</div><div style="font-style:italic; color:#666; margin-top:8px;">${item[4].en}</div>`;
            if(currentMode === 'study') {
                hint.classList.remove('hidden');
                speakItem(false); 
            } else {
                interaction.innerHTML = `<button class="option-btn" onclick="document.getElementById('hint-box').classList.toggle('hidden')">ğŸ‘ï¸ Show/Hide Reply</button>`;
                speakItem(false);
            }
            interaction.innerHTML += `<button class="option-btn" onclick="nextCard()" style="background:var(--primary); color:white;">Next â†’</button>`;
        } else {
            let opts = [item[4].cn, "æˆ‘ä¸è®¤è¯†ã€‚", "ä»–åœ¨å®¶é‡Œã€‚", "å¯¹ä¸èµ·ã€‚", "å†è§ã€‚"].slice(0, 4);
            if(!opts.includes(item[4].cn)) opts[0] = item[4].cn;
            opts.sort(() => Math.random() - 0.5);
            opts.forEach(o => {
                const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = o;
                b.onclick = () => {
                    if(o === item[4].cn) {
                        playEffect('coin'); score += 10; document.getElementById('score-val').innerText = score;
                        b.style.background = "#4caf50"; b.style.color = "white";
                        
                        if(currentMode === 'practice') {
                            speakText(item[4].cn, () => setTimeout(nextCard, 300));
                        } else {
                            speakText(item[4].cn);
                            nextCard();
                        }
                    } else { 
                        playEffect('fail'); 
                        b.style.background = "#f44336"; b.style.color = "white"; 
                        if (!wrongAnswers.includes(item)) {
                            wrongAnswers.push(item);
                        }
                    }
                };
                interaction.appendChild(b);
            });
            speakItem(false);
        }
    }

    function nextCard() {
        currentIndex++;
        if (currentIndex >= database.length) {
            if (currentMode === 'quiz' || currentMode === 'practice') showFinalResult();
            else { currentIndex = 0; render(); }
        } else render();
    }

    function renderList() {
        const view = document.getElementById('scroll-view');
        view.innerHTML = "<h2>ğŸ“œ HSK 1 Sentence Bank</h2>";
        database.forEach((it, idx) => {
            const r = document.createElement('div'); r.className = 'list-row';
            r.innerHTML = `<strong>${idx+1}.</strong> <span style="font-size:24px;">${it[0]}</span><br><span style="color:var(--pinyin); font-weight:bold;">${it[1]}</span><br><span style="color:#666">${it[2]}</span>`;
            r.onclick = () => speakText(it[0]);
            view.appendChild(r);
        });
    }

    function renderWrongBook() {
        const view = document.getElementById('scroll-view');
        view.innerHTML = "<h2>âŒ My Mistakes</h2>";
        if (wrongAnswers.length === 0) {
            view.innerHTML += "<p style='font-size:20px; color:#666;'>No mistakes recorded yet. Keep practicing!</p>";
            return;
        }
        wrongAnswers.forEach((it, idx) => {
            const r = document.createElement('div'); r.className = 'list-row';
            r.innerHTML = `<strong>${idx+1}.</strong> <span style="font-size:24px;">${it[0]}</span><br><span style="color:var(--pinyin); font-weight:bold;">${it[1]}</span><br><span style="color:#666">${it[2]}</span><div style="margin-top:8px; color:var(--primary); font-weight:bold;">Reply: ${it[4].cn}</div>`;
            r.onclick = () => speakText(it[0]);
            view.appendChild(r);
        });
    }

    window.onload = () => initStars();
</script>
</body>
</html>