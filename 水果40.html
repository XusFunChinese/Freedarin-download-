<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40 Fruits - XusFunChinese Edition</title>
    <style>
        :root {
            --primary-blue: #2980b9;
            --dark-gray: #2c3e50;
            --accent-orange: #f39c12;
            --bg-light: #f0f2f5;
            --text-black: #1a1a1a;
            --correct-green: #2ecc71;
            --wrong-red: #e74c3c;
            --pinyin-color: #ff4500; 
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif, 'Microsoft YaHei';
            background-color: var(--bg-light);
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 95vw; height: 95vh; max-width: 900px; background: white; 
            padding: 1rem; box-sizing: border-box; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-radius: 20px; position: relative;
        }

        .nav-grid { 
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; 
            margin-bottom: 15px; flex-shrink: 0;
        }
        .nav-grid button { 
            font-size: 0.8rem; padding: 12px 2px; background: #f5f5f5; 
            border-radius: 10px; border: none; color: #666; cursor: pointer; font-weight: bold; 
        }
        .nav-grid button.active { background: var(--dark-gray); color: white; }

        .card-scene { 
            flex-grow: 1; perspective: 1200px; position: relative; 
            display: flex; justify-content: center; align-items: center;
        }

        /* Ê∞¥Âç∞ÔºöÊîæÂú®ËØçÂç°Âú∫ÊôØÂÜÖÔºåÁ°Æ‰øùÂ±ÇÁ∫ßÊúÄÈ´ò */
        .watermark {
            position: absolute; bottom: 15px; right: 35px;
            font-size: 1.1rem; font-weight: 800; 
            color: rgba(44, 62, 80, 0.25); /* Ê∑±Ëâ≤ÂçäÈÄèÊòéÔºåÊ∏ÖÊô∞ÂèØËßÅ */
            pointer-events: none; z-index: 100; font-family: 'Arial Black', sans-serif;
            text-transform: uppercase;
        }

        .card { 
            width: 90%; aspect-ratio: 16 / 9; position: relative; 
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s; 
            transform-style: preserve-3d; cursor: pointer; 
        }
        .card.is-flipped { transform: rotateY(180deg); }
        .card.is-switching { opacity: 0; }
        
        .card-face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: white; border-radius: 20px; border: 1px solid #eee;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 20px; box-sizing: border-box;
        }
        
        .card-back { transform: rotateY(180deg); background: #ffffff; }

        .emoji-huge { font-size: 7rem; margin: 0; }
        .word-ruby { font-size: 4rem; font-weight: 900; color: var(--text-black); line-height: 1.4; }
        rt { font-size: 1.2rem; color: var(--pinyin-color); font-weight: bold; }
        
        .word-en-huge { font-size: 4.5rem; font-weight: 800; color: var(--primary-blue); }
        .back-eng-title { font-size: 2.2rem; font-weight: bold; color: var(--accent-orange); margin: 5px 0; }
        
        /* ‰æãÂè•ÊãºÈü≥ÂØπÈΩêÊ†∑Âºè */
        .ex-container { width: 100%; padding-top: 15px; border-top: 2px dashed #f0f0f0; margin-top: 15px; text-align: center; }
        .ex-ruby { font-size: 1.8rem; font-weight: bold; color: #333; line-height: 2.2; }
        .ex-ruby rt { font-size: 0.9rem; color: #888; font-weight: normal; }
        .ex-en { font-size: 1.1rem; color: #666; font-style: italic; margin-top: 5px; }

        #progress-tag { position: absolute; top: 10px; left: 20px; font-size: 1rem; color: #ddd; font-weight: bold; }

        .quiz-opts { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 700px; margin-top: 20px; }
        .opt-btn { padding: 20px; border: 2px solid #eee; background: white; border-radius: 15px; font-size: 1.5rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .opt-btn.correct { background-color: var(--correct-green) !important; color: white; border-color: var(--correct-green); }
        .opt-btn.wrong { background-color: var(--wrong-red) !important; color: white; border-color: var(--wrong-red); animation: shake 0.4s; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }

        #summary-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f9f9f9; border-radius: 12px; cursor: pointer; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app">
    <div class="nav-grid" id="nav-btns">
        <button onclick="startMode('learn')" class="active">Â≠¶‰π†Ê®°Âºè</button>
        <button onclick="startMode('card-cn')">ÁúãÂ≠óËØÜÊÑè</button>
        <button onclick="startMode('card-en')">ÁúãÈü≥Ëæ©ËØç</button>
        <button onclick="startMode('quiz')">Ë∂£Âë≥ÊµãËØï</button>
        <button onclick="startMode('timed')">ÊûÅÈÄüÊåëÊàò</button>
        <button onclick="startMode('summary')">ÂçïËØçÂàóË°®</button>
    </div>

    <div id="card-container" class="mode-view">
        <div class="card-scene">
            <div id="progress-tag">01/40</div>
            
            <div class="watermark">XusFunChinese</div>

            <div class="card" id="display-card" onclick="handleCardClick()">
                <div class="card-face card-front" id="card-f"></div>
                <div class="card-face card-back" id="card-b"></div>
            </div>
        </div>
    </div>

    <div id="summary-container" class="mode-view hidden" style="flex-grow:1; overflow-y:auto;">
        <div id="summary-list"></div>
    </div>

    <div id="quiz-container" class="mode-view hidden" style="flex-grow:1; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative;">
        <div class="watermark">XusFunChinese</div>
        <div style="width:100%; display:flex; justify-content:space-between; font-weight:bold; color:#aaa; padding: 0 20px;">
            <span id="quiz-score-tag">SCORE: 0</span>
            <span id="quiz-timer-tag" style="color:var(--accent-orange)"></span>
        </div>
        <div id="quiz-q" style="font-size:5rem; font-weight:bold; margin: 20px 0; color:var(--primary-blue);"></div>
        <div id="quiz-opts" class="quiz-opts"></div>
    </div>
</div>

<script>
    const fruits = [
        { word: "ËãπÊûú", pinyin: "p√≠ng gu«í", eng: "Apple", emoji: "üçé", exZh: "ÊàëÂêÉËãπÊûú", exPy: "w«í chƒ´ p√≠ng gu«í", exEn: "I eat an apple." },
        { word: "È¶ôËïâ", pinyin: "xiƒÅng jiƒÅo", eng: "Banana", emoji: "üçå", exZh: "Áå¥Â≠êÊãøÈ¶ôËïâ", exPy: "h√≥u zi n√° xiƒÅng jiƒÅo", exEn: "The monkey takes the banana." },
        { word: "Ë•øÁìú", pinyin: "xƒ´ guƒÅ", eng: "Watermelon", emoji: "üçâ", exZh: "Âì•Âì•Êä±Ë•øÁìú", exPy: "gƒì ge b√†o xƒ´ guƒÅ", exEn: "Brother holds the watermelon." },
        { word: "ËçâËéì", pinyin: "c«éo m√©i", eng: "Strawberry", emoji: "üçì", exZh: "ÊàëÂñúÊ¨¢ËçâËéì", exPy: "w«í x«ê huan c«éo m√©i", exEn: "I like strawberries." },
        { word: "Ëë°ËêÑ", pinyin: "p√∫ tao", eng: "Grape", emoji: "üçá", exZh: "Â•∂Â•∂Ê¥óËë°ËêÑ", exPy: "n«éi nai x«ê p√∫ tao", exEn: "Grandma washes grapes." },
        { word: "Ê©ôÂ≠ê", pinyin: "ch√©ng zi", eng: "Orange", emoji: "üçä", exZh: "Â¶àÂ¶àÂàáÊ©ôÂ≠ê", exPy: "mƒÅ ma qiƒì ch√©ng zi", exEn: "Mom cuts the orange." },
        { word: "Ê¢®Â≠ê", pinyin: "l√≠ zi", eng: "Pear", emoji: "üçê", exZh: "‰ªñ‰π∞‰∏Ä‰∏™Ê¢®", exPy: "tƒÅ m«éi y√≠ g√® l√≠", exEn: "He buys a pear." },
        { word: "Êü†Ê™¨", pinyin: "n√≠ng m√©ng", eng: "Lemon", emoji: "üçã", exZh: "Êü†Ê™¨ÂæàÈÖ∏Âì¶", exPy: "n√≠ng m√©ng hƒõn suƒÅn o", exEn: "The lemon is very sour." },
        { word: "ËäíÊûú", pinyin: "m√°ng gu«í", eng: "Mango", emoji: "ü•≠", exZh: "ÂßêÂßêÂêÉËäíÊûú", exPy: "jiƒõ jie chƒ´ m√°ng gu«í", exEn: "Sister eats a mango." },
        { word: "Ëè†Ëêù", pinyin: "b≈ç lu√≥", eng: "Pineapple", emoji: "üçç", exZh: "Âé®Â∏àÂâäËè†Ëêù", exPy: "ch√∫ shƒ´ xiƒÅo b≈ç lu√≥", exEn: "The chef peels the pineapple." },
        { word: "Ê®±Ê°É", pinyin: "yƒ´ng t√°o", eng: "Cherry", emoji: "üçí", exZh: "‰ªñÊï∞ÁùÄÊ®±Ê°É", exPy: "tƒÅ sh«î zhe yƒ´ng t√°o", exEn: "He counts the cherries." },
        { word: "Ê°ÉÂ≠ê", pinyin: "t√°o zi", eng: "Peach", emoji: "üçë", exZh: "ËøôÊúâ‰∏™Ê°ÉÂ≠ê", exPy: "zh√® y«íu g√® t√°o zi", exEn: "There is a peach." },
        { word: "ÁåïÁå¥Ê°É", pinyin: "m√≠ h√≥u t√°o", eng: "Kiwi", emoji: "ü•ù", exZh: "È∏üÂêÉÁåïÁå¥Ê°É", exPy: "ni«éo chƒ´ m√≠ h√≥u t√°o", exEn: "Birds eat kiwi." },
        { word: "ËìùËéì", pinyin: "l√°n m√©i", eng: "Blueberry", emoji: "ü´ê", exZh: "ÁõòÈáåÊúâËìùËéì", exPy: "p√°n l«ê y«íu l√°n m√©i", exEn: "There are blueberries in the plate." },
        { word: "Ê§∞Â≠ê", pinyin: "y√© zi", eng: "Coconut", emoji: "ü••", exZh: "‰ªñÂú®ÂñùÊ§∞Â≠ê", exPy: "tƒÅ z√†i hƒì y√© zi", exEn: "He is drinking coconut." },
        { word: "Êú®Áìú", pinyin: "m√π guƒÅ", eng: "Papaya", emoji: "ü•≠", exZh: "‰ªñÁà±ÂêÉÊú®Áìú", exPy: "tƒÅ √†i chƒ´ m√π guƒÅ", exEn: "He loves papaya." },
        { word: "ÁÅ´ÈæôÊûú", pinyin: "hu«í l√≥ng gu«í", eng: "Dragon Fruit", emoji: "üåµ", exZh: "Êàë‰π∞ÁÅ´ÈæôÊûú", exPy: "w«í m«éi hu«í l√≥ng gu«í", exEn: "I buy dragon fruit." },
        { word: "ÁâõÊ≤πÊûú", pinyin: "ni√∫ y√≥u gu«í", eng: "Avocado", emoji: "ü•ë", exZh: "‰ªñÂÅöÁâõÊ≤πÊûú", exPy: "tƒÅ zu√≤ ni√∫ y√≥u gu«í", exEn: "He makes avocado." },
        { word: "ÂìàÂØÜÁìú", pinyin: "hƒÅ m√¨ guƒÅ", eng: "Cantaloupe", emoji: "üçà", exZh: "ËøôÁìúÂæàÁîúÂì¶", exPy: "zh√® guƒÅ hƒõn ti√°n o", exEn: "This melon is very sweet." },
        { word: "ËçîÊûù", pinyin: "l√¨ zhƒ´", eng: "Lychee", emoji: "üî¥", exZh: "‰ªñÁà±ÂêÉËçîÊûù", exPy: "tƒÅ √†i chƒ´ l√¨ zhƒ´", exEn: "He loves lychees." },
        { word: "Ê¶¥Ëé≤", pinyin: "li√∫ li√°n", eng: "Durian", emoji: "üçà", exZh: "Ê¶¥Ëé≤ÈùûÂ∏∏Ëá≠", exPy: "li√∫ li√°n fƒìi ch√°ng ch√≤u", exEn: "Durian is very smelly." },
        { word: "Áü≥Ê¶¥", pinyin: "sh√≠ liu", eng: "Pomegranate", emoji: "üçé", exZh: "Áü≥Ê¶¥Á±ΩÁ∫¢‰∫Ü", exPy: "sh√≠ liu z«ê h√≥ng le", exEn: "Pomegranate seeds turned red." },
        { word: "ÊùéÂ≠ê", pinyin: "l«ê zi", eng: "Plum", emoji: "ü´ê", exZh: "Â¶πÂ¶πË¶ÅÊùéÂ≠ê", exPy: "m√®i mei y√†o l«ê zi", exEn: "Sister wants plums." },
        { word: "ÊüöÂ≠ê", pinyin: "y√≤u zi", eng: "Pomelo", emoji: "üçà", exZh: "Áà∏Áà∏‰π∞ÊüöÂ≠ê", exPy: "b√† ba m«éi y√≤u zi", exEn: "Dad buys a pomelo." },
        { word: "Â±±Á´π", pinyin: "shƒÅn zh√∫", eng: "Mangosteen", emoji: "üü£", exZh: "ÁôΩËâ≤ÁöÑÂ±±Á´π", exPy: "b√°i s√® de shƒÅn zh√∫", exEn: "The white mangosteen." },
        { word: "ÊüøÂ≠ê", pinyin: "sh√¨ zi", eng: "Persimmon", emoji: "üçÖ", exZh: "ÊüøÂ≠êÂèòÁ∫¢‰∫Ü", exPy: "sh√¨ zi bi√†n h√≥ng le", exEn: "The persimmon turned red." },
        { word: "ÊûáÊù∑", pinyin: "p√≠ p√°", eng: "Loquat", emoji: "üü†", exZh: "ÊûáÊù∑ÂæàÂ•ΩÂêÉ", exPy: "p√≠ p√° hƒõn h«éo chƒ´", exEn: "Loquat is delicious." },
        { word: "Êù®Ê°É", pinyin: "y√°ng t√°o", eng: "Starfruit", emoji: "‚≠ê", exZh: "‰ªñÂú®ÁúãÊù®Ê°É", exPy: "tƒÅ z√†i k√†n y√°ng t√°o", exEn: "He is looking at starfruit." },
        { word: "Ê°ëËëö", pinyin: "sƒÅng sh√®n", eng: "Mulberry", emoji: "üçá", exZh: "ÁõòÈáåÊúâÊ°ëËëö", exPy: "p√°n l«ê y«íu sƒÅng sh√®n", exEn: "There are mulberries in the plate." },
        { word: "Êó†Ëä±Êûú", pinyin: "w√∫ huƒÅ gu«í", eng: "Fig", emoji: "üçÇ", exZh: "ÊàëÊëòÊó†Ëä±Êûú", exPy: "w«í zhƒÅi w√∫ huƒÅ gu«í", exEn: "I pick a fig." },
        { word: "ÁîòËîó", pinyin: "gƒÅn zh√®", eng: "Sugarcane", emoji: "üéã", exZh: "ÊàëÂöºÁùÄÁîòËîó", exPy: "w«í ji√°o zhe gƒÅn zh√®", exEn: "I am chewing sugarcane." },
        { word: "Á∫¢ÊØõ‰∏π", pinyin: "h√≥ng m√°o dƒÅn", eng: "Rambutan", emoji: "‚òÑÔ∏è", exZh: "ËøôÊòØÁ∫¢ÊØõ‰∏π", exPy: "zh√® sh√¨ h√≥ng m√°o dƒÅn", exEn: "This is a rambutan." },
        { word: "Ê≥¢ÁΩóËúú", pinyin: "b≈ç lu√≥ m√¨", eng: "Jackfruit", emoji: "üçê", exZh: "ÂÆÉÂè´Ê≥¢ÁΩóËúú", exPy: "tƒÅ ji√†o b≈ç lu√≥ m√¨", exEn: "It is called jackfruit." },
        { word: "ÁôæÈ¶ôÊûú", pinyin: "b«éi xiƒÅng gu«í", eng: "Passion Fruit", emoji: "üü£", exZh: "Â•πÁà±ÁôæÈ¶ôÊûú", exPy: "tƒÅ √†i b«éi xiƒÅng gu«í", exEn: "She loves passion fruit." },
        { word: "ÊùèÂ≠ê", pinyin: "x√¨ng zi", eng: "Apricot", emoji: "üçë", exZh: "Ê†ë‰∏äÊúâÊùèÂ≠ê", exPy: "sh√π sh√†ng y«íu x√¨ng zi", exEn: "There are apricots on the tree." },
        { word: "Ê†ëËéì", pinyin: "sh√π m√©i", eng: "Raspberry", emoji: "üçì", exZh: "‰ªñÈááÊëòÊ†ëËéì", exPy: "tƒÅ c«éi zhƒÅi sh√π m√©i", exEn: "He picks raspberries." },
        { word: "ËîìË∂äËéì", pinyin: "m√†n yu√® m√©i", eng: "Cranberry", emoji: "üçí", exZh: "Êàë‰π∞ËîìË∂äËéì", exPy: "w«í m«éi m√†n yu√® m√©i", exEn: "I buy cranberries." },
        { word: "ÈªëËéì", pinyin: "hƒìi m√©i", eng: "Blackberry", emoji: "üçá", exZh: "Âú∞ÈáåÈïøÈªëËéì", exPy: "d√¨ l«ê zh«éng hƒìi m√©i", exEn: "Blackberries grow in the field." },
        { word: "ÈæôÁúº", pinyin: "l√≥ng y«én", eng: "Longan", emoji: "‚ö™", exZh: "Áà∑Áà∑ÂêÉÈæôÁúº", exPy: "y√© ye chƒ´ l√≥ng y«én", exEn: "Grandpa eats longan." },
        { word: "Ê©òÂ≠ê", pinyin: "j√∫ zi", eng: "Mandarin", emoji: "üçä", exZh: "ÊàëÂâ•ÂºÄÊ©òÂ≠ê", exPy: "w«í b≈ç kƒÅi j√∫ zi", exEn: "I peel the mandarin." }
    ];

    let currentIdx = 0, currentMode = 'learn', score = 0, rushTimer, timeLeft = 30;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playAudioFeedback(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'correct') {
            osc.frequency.setValueAtTime(523, now); osc.frequency.exponentialRampToValueAtTime(880, now + 0.1);
            gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(); osc.stop(now + 0.3);
        } else {
            osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(80, now + 0.3);
            gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.3);
            osc.start(); osc.stop(now + 0.3);
        }
    }

    function speak(text, callback) {
        if (!/[\u4e00-\u9fa5]/.test(text)) { if(callback) callback(); return; }
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'zh-CN';
        if(callback) msg.onend = callback;
        window.speechSynthesis.speak(msg);
    }

    function startMode(m) {
        currentMode = m; score = 0; clearInterval(rushTimer);
        document.querySelectorAll('.mode-view').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.nav-grid button').forEach(b => b.classList.remove('active'));
        if(event) event.target.classList.add('active');

        if(m === 'summary') {
            document.getElementById('summary-container').classList.remove('hidden');
            renderSummary();
        } else if(m === 'quiz' || m === 'timed') {
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-score-tag').innerText = "SCORE: 0";
            if(m === 'timed') {
                timeLeft = 30;
                rushTimer = setInterval(() => {
                    timeLeft -= 0.1;
                    document.getElementById('quiz-timer-tag').innerText = Math.ceil(timeLeft) + "s";
                    if(timeLeft <= 0) { 
                        clearInterval(rushTimer); 
                        speak("Â§™Ê£í‰∫ÜÔºÅÊµãËØïÁªìÊùü"); 
                        alert("Êó∂Èó¥Âà∞ÔºÅÂæóÂàÜ: " + score); 
                        startMode('learn'); 
                    }
                }, 100);
            } else { document.getElementById('quiz-timer-tag').innerText = ""; }
            nextQ();
        } else {
            document.getElementById('card-container').classList.remove('hidden');
            renderDisplayCard(true);
        }
    }

    function renderDisplayCard(immediate = false) {
        const h = fruits[currentIdx];
        const card = document.getElementById('display-card');
        if(immediate) { updateCardContent(h); return; }
        card.classList.add('is-switching');
        setTimeout(() => { updateCardContent(h); card.classList.remove('is-switching'); }, 200);
    }

    function updateCardContent(h) {
        let frontHTML = '', speakText = h.word;
        if(currentMode === 'learn') {
            frontHTML = `<div class="emoji-huge">${h.emoji}</div><ruby class="word-ruby">${h.word}<rt>${h.pinyin}</rt></ruby>`;
        } else if(currentMode === 'card-cn') {
            frontHTML = `<div style="font-size:8rem; font-weight:bold;">${h.word}</div>`;
        } else if(currentMode === 'card-en') {
            frontHTML = `<div class="word-en-huge">${h.eng}</div>`; speakText = h.eng;
        }
        
        document.getElementById('card-f').innerHTML = frontHTML;
        document.getElementById('card-b').innerHTML = `
            <div class="emoji-huge" style="font-size:4rem; margin-bottom:0;">${h.emoji}</div>
            <ruby class="word-ruby" style="font-size:3.5rem;">${h.word}<rt>${h.pinyin}</rt></ruby>
            <div class="back-eng-title">${h.eng}</div>
            <div class="ex-container">
                <div class="ex-ruby">${generateRuby(h.exZh, h.exPy)}</div>
                <div class="ex-en">${h.exEn}</div>
            </div>`;
        document.getElementById('progress-tag').innerText = (currentIdx + 1).toString().padStart(2, '0') + "/40";
        speak(speakText);
    }

    function generateRuby(zh, py) {
        const chars = zh.split(''); const pinyins = py.split(' ');
        return chars.map((c, i) => `<ruby>${c}<rt>${pinyins[i] || ''}</rt></ruby>`).join('');
    }

    function handleCardClick() {
        const card = document.getElementById('display-card');
        const h = fruits[currentIdx];
        if(!card.classList.contains('is-flipped')) {
            card.classList.add('is-flipped'); 
            if(currentMode === 'card-en') {
                speak(h.word, () => { setTimeout(() => speak(h.exZh), 500); });
            } else { speak(h.exZh); }
        } else {
            card.classList.remove('is-flipped'); currentIdx = (currentIdx + 1) % fruits.length;
            setTimeout(() => { renderDisplayCard(); }, 300); 
        }
    }

    function renderSummary() {
        document.getElementById('summary-list').innerHTML = fruits.map((h, i) => `
            <div class="list-item" onclick="currentIdx=${i}; startMode('learn');">
                <div style="text-align:left"><span style="font-size:1.6rem; font-weight:bold;">${h.emoji} ${h.word}</span></div>
                <div style="color:var(--primary-blue); font-size:1.1rem; font-weight:600;">${h.eng}</div>
            </div>`).join('');
    }

    function nextQ() {
        const h = fruits[Math.floor(Math.random() * fruits.length)];
        const isCN = Math.random() > 0.5;
        document.getElementById('quiz-q').innerText = isCN ? h.word : h.eng;
        const correct = isCN ? h.eng : h.word;
        let opts = [correct];
        while(opts.length < 4) {
            let f = fruits[Math.floor(Math.random() * fruits.length)][isCN ? 'eng' : 'word'];
            if(!opts.includes(f)) opts.push(f);
        }
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('quiz-opts').innerHTML = opts.map(o => `
            <button class="opt-btn" onclick="checkQuizAnswer(this, '${o}', '${correct}')">${o}</button>`).join('');
    }

    function checkQuizAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);
        const correctWordCN = /[\u4e00-\u9fa5]/.test(correct) ? correct : fruits.find(f => f.eng === correct).word;

        if(selected === correct) {
            playAudioFeedback('correct'); 
            btn.classList.add('correct');
            score += 10;
        } else {
            playAudioFeedback('wrong'); 
            btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
            score = Math.max(0, score - 5); 
            if(currentMode === 'timed') timeLeft -= 1.5;
        }
        
        speak(correctWordCN);
        document.getElementById('quiz-score-tag').innerText = "SCORE: " + score;
        setTimeout(nextQ, 1500);
    }

    startMode('learn');
</script>
</body>
</html>