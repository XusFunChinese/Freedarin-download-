<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>XUSFUNCHINESE - Top 500 High-Frequency Writing Mode üèÆ</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
    <style>
        :root { 
            --pinyin-red: #d63031; 
            --paper: rgba(255, 255, 255, 0.95); 
            --gold: #fbc02d; 
            --accent: #218c74; 
            --primary: #01579b;
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
            --gray: #ccc;
        }
        body { 
            margin: 0; font-family: "Arial Black", sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        /* Cover */
        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s; cursor: pointer;
        }
        .shiny-title {
            font-size: 8vw; font-weight: 900; text-align: center;
            background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255,215,0,0.5));
            animation: shine 3s infinite linear;
        }
        @keyframes shine { 0% { background-position: 0%; } 100% { background-position: 200%; } }

        /* Header */
        header { background: var(--paper); padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; }
        .nav-btns button { padding: 8px 15px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); cursor: pointer; font-weight: bold; background: white; color: var(--primary); }
        .active-btn { background: var(--primary) !important; color: white !important; }

        main { flex: 1; display: flex; padding: 20px; gap: 20px; overflow: hidden; }
        #left-panel { 
            flex: 1; background: var(--paper); border-radius: 30px; display: flex; flex-direction: column; 
            align-items: center; justify-content: flex-start; position: relative; border: 5px solid var(--gold);
            padding: 15px 20px 20px 20px; box-sizing: border-box;
        }
        #right-panel { flex: 1; background: var(--paper); border-radius: 30px; padding: 20px; overflow-y: auto; border: 5px solid var(--gold); }

        /* Writing area */
        #writer-container { 
            display: flex; flex-direction: row; justify-content: center; align-items: center;
            gap: 15px; padding: 10px 0; width: 100%; overflow-x: auto; overflow-y: hidden;
            scrollbar-width: none;
        }
        #writer-container::-webkit-scrollbar { display: none; }
        .char-writer { 
            flex: 0 0 240px; width: 240px; height: 240px; background: white; border: 2px solid #ccc; 
            touch-action: none; position: relative; cursor: pointer;
        }
        .char-writer.inactive { opacity: 0.4; filter: grayscale(80%); }
        .char-writer.active { border: 4px solid var(--gold); }
        
        .pinyin { 
            font-size: 32px; color: var(--pinyin-red); font-weight: bold; margin: 0 0 10px 0; 
            text-align: center; max-width: 95%; word-wrap: break-word;
        }
        .meaning { 
            font-size: 20px; color: #555; margin: 0 0 15px 0; text-align: center; 
            max-width: 95%; word-wrap: break-word;
        }

        .list-card { background: white; margin-bottom: 10px; padding: 15px; border-radius: 15px; display: flex; align-items: center; cursor: pointer; border-left: 8px solid var(--primary); transition: 0.2s; }
        .list-card:hover { transform: translateX(10px); background: var(--accent); color: white; }
        .list-char { font-size: 30px; min-width: 80px; text-align: center; }
        
        #hint-area { font-size: 18px; color: var(--primary); margin: 10px 0; font-weight: bold; height: 25px; text-align: center; }
        .watermark { position: fixed; bottom: 10px; right: 20px; color: rgba(255,255,255,0.3); font-style: italic; pointer-events: none; }

        .mode-desc { margin-top: 10px; font-size: 16px; color: #333; text-align: center; max-width: 85%; }

        .button-area {
            margin-top: 20px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center;
            width: 100%; box-sizing: border-box;
        }

        #pinyin-search { width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 10px; border: 2px solid var(--primary); font-size: 16px; }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div class="shiny-title">Top 500<br>High-Frequency WRITING MODE</div>
    <p style="color:white; margin-top:20px; letter-spacing:3px;">üèÆ CLICK TO START üèÆ</p>
</div>

<div class="watermark">XUSFUNCHINESE</div>

<header>
    <div class="nav-btns">
        <button id="btn-learn" onclick="switchMode('learn')" class="active-btn">üìñ Learn</button>
        <button id="btn-test" onclick="switchMode('test')">üìù Practice</button>
        <button id="btn-quiz" onclick="switchMode('quiz')">‚ùì Quiz</button>
        <button id="btn-list" onclick="switchMode('list')">üìú List</button>
        <button id="btn-wrong" onclick="switchMode('wrong')">‚ùå Mistakes</button>
    </div>
    <div style="font-weight:bold; color:var(--primary)">Top 500 High-Frequency Writing - <span id="progress">1</span>/500</div>
</header>

<main>
    <div id="left-panel">
        <div id="pinyin-display" class="pinyin"></div>
        <div id="writer-container"></div>
        <div id="meaning-display" class="meaning"></div>
        <div id="hint-area"></div>
        <div class="mode-desc" id="mode-description"></div>
        <div class="button-area">
            <button onclick="prevItem()" style="padding:10px 20px; border-radius:10px;">Previous</button>
            <button onclick="showHint()" id="hint-btn" style="padding:10px 20px; border-radius:10px; background:var(--gold); border:none; font-weight:bold;">Show Hint</button>
            <button onclick="nextItem()" style="padding:10px 20px; border-radius:10px;">Next</button>
        </div>
    </div>

    <div id="right-panel">
        <div id="list-view" style="display:none;"></div>
        <div id="wrong-view" style="display:none;"></div>
        <div id="info-view" style="display:block;">
            <h3 id="info-title">Mode Guide</h3>
            <p id="info-text"></p>
            <div id="stats" style="margin-top:30px; padding:20px; background:var(--accent); color:white; border-radius:20px;">
                Mastery Progress: <span id="stat-done">0</span> / 500
            </div>
        </div>
    </div>
</main>

<script>
const vocabulary = [
    {c:"ÁöÑ", p:"de", m:"(possessive particle), of"},
    {c:"‰∏Ä", p:"yƒ´", m:"one"},
    {c:"ÊòØ", p:"sh√¨", m:"is, are, am, yes"},
    {c:"‰∏ç", p:"b√π", m:"not, no"},
    {c:"‰∫Ü", p:"le", m:"(completed action particle)"},
    {c:"Âú®", p:"z√†i", m:"(located) at, in, exist"},
    {c:"‰∫∫", p:"r√©n", m:"person, people"},
    {c:"Êúâ", p:"y«íu", m:"have, there is"},
    {c:"Êàë", p:"w«í", m:"I, me"},
    {c:"‰ªñ", p:"tƒÅ", m:"he, him"},
    {c:"Ëøô", p:"zh√®", m:"this"},
    {c:"‰∏™", p:"g√®", m:"(general measure word)"},
    {c:"‰ª¨", p:"men", m:"(plural marker for pronouns)"},
    {c:"‰∏≠", p:"zh≈çng", m:"middle, in"},
    {c:"Êù•", p:"l√°i", m:"come"},
    {c:"‰∏ä", p:"sh√†ng", m:"on, above"},
    {c:"Â§ß", p:"d√†", m:"big, great"},
    {c:"‰∏∫", p:"w√®i", m:"for, because"},
    {c:"Âíå", p:"h√©", m:"and"},
    {c:"ÂõΩ", p:"gu√≥", m:"country"},
    {c:"Âú∞", p:"de", m:"(adverbial particle)"},
    {c:"Âà∞", p:"d√†o", m:"to, until"},
    {c:"‰ª•", p:"y«ê", m:"with, by"},
    {c:"ËØ¥", p:"shu≈ç", m:"say, speak"},
    {c:"Êó∂", p:"sh√≠", m:"time"},
    {c:"Ë¶Å", p:"y√†o", m:"want, must"},
    {c:"Â∞±", p:"ji√π", m:"just, then"},
    {c:"Âá∫", p:"ch≈´", m:"go out"},
    {c:"‰ºö", p:"hu√¨", m:"can, will"},
    {c:"ÂèØ", p:"kƒõ", m:"can, may"},
    {c:"‰πü", p:"yƒõ", m:"also"},
    {c:"‰Ω†", p:"n«ê", m:"you"},
    {c:"ÂØπ", p:"du√¨", m:"correct"},
    {c:"Áîü", p:"shƒìng", m:"life"},
    {c:"ËÉΩ", p:"n√©ng", m:"can"},
    {c:"ËÄå", p:"√©r", m:"and"},
    {c:"Â≠ê", p:"zi", m:"child"},
    {c:"ÈÇ£", p:"n√†", m:"that"},
    {c:"Âæó", p:"de", m:"(resultative particle)"},
    {c:"‰∫é", p:"y√∫", m:"in, at"},
    {c:"‰∏ã", p:"xi√†", m:"down"},
    {c:"Ëá™", p:"z√¨", m:"self"},
    {c:"‰πã", p:"zhƒ´", m:"(possessive particle)"},
    {c:"Âπ¥", p:"ni√°n", m:"year"},
    {c:"Ëøá", p:"gu√≤", m:"pass"},
    {c:"Âèë", p:"fƒÅ", m:"send out"},
    {c:"Âêé", p:"h√≤u", m:"after"},
    {c:"‰Ωú", p:"zu√≤", m:"do, make"},
    {c:"Èáå", p:"l«ê", m:"inside"},
    {c:"Áî®", p:"y√≤ng", m:"use"},
    {c:"ÈÅì", p:"d√†o", m:"way"},
    {c:"Ë°å", p:"x√≠ng", m:"go"},
    {c:"ÊâÄ", p:"su«í", m:"place"},
    {c:"ÁÑ∂", p:"r√°n", m:"so"},
    {c:"ÂÆ∂", p:"jiƒÅ", m:"home"},
    {c:"Áßç", p:"zh«íng", m:"kind"},
    {c:"‰∫ã", p:"sh√¨", m:"matter"},
    {c:"Êàê", p:"ch√©ng", m:"become"},
    {c:"Êñπ", p:"fƒÅng", m:"side"},
    {c:"Â§ö", p:"du≈ç", m:"many"},
    {c:"Áªè", p:"jƒ´ng", m:"pass through"},
    {c:"‰πà", p:"me", m:"(question particle)"},
    {c:"Âéª", p:"q√π", m:"go"},
    {c:"Ê≥ï", p:"f«é", m:"law"},
    {c:"Â≠¶", p:"xu√©", m:"study"},
    {c:"Â¶Ç", p:"r√∫", m:"like"},
    {c:"ÈÉΩ", p:"d≈çu", m:"all"},
    {c:"Âêå", p:"t√≥ng", m:"same"},
    {c:"Áé∞", p:"xi√†n", m:"now"},
    {c:"ÂΩì", p:"dƒÅng", m:"when"},
    {c:"Ê≤°", p:"m√©i", m:"not have"},
    {c:"Âä®", p:"d√≤ng", m:"move"},
    {c:"Èù¢", p:"mi√†n", m:"face"},
    {c:"Ëµ∑", p:"q«ê", m:"rise"},
    {c:"Áúã", p:"k√†n", m:"look"},
    {c:"ÂÆö", p:"d√¨ng", m:"decide"},
    {c:"Â§©", p:"tiƒÅn", m:"day"},
    {c:"ÂàÜ", p:"fƒìn", m:"divide"},
    {c:"Ëøò", p:"h√°i", m:"still"},
    {c:"Ëøõ", p:"j√¨n", m:"enter"},
    {c:"Â•Ω", p:"h«éo", m:"good"},
    {c:"Â∞è", p:"xi«éo", m:"small"},
    {c:"ÈÉ®", p:"b√π", m:"part"},
    {c:"ÂÖ∂", p:"q√≠", m:"its"},
    {c:"‰∫õ", p:"xiƒì", m:"some"},
    {c:"‰∏ª", p:"zh«î", m:"main"},
    {c:"Ê†∑", p:"y√†ng", m:"appearance"},
    {c:"ÁêÜ", p:"l«ê", m:"reason"},
    {c:"ÂøÉ", p:"xƒ´n", m:"heart"},
    {c:"Â•π", p:"tƒÅ", m:"she"},
    {c:"Êú¨", p:"bƒõn", m:"root"},
    {c:"Ââç", p:"qi√°n", m:"front"},
    {c:"ÂºÄ", p:"kƒÅi", m:"open"},
    {c:"‰ΩÜ", p:"d√†n", m:"but"},
    {c:"Âõ†", p:"yƒ´n", m:"cause"},
    {c:"Âè™", p:"zh«ê", m:"only"},
    {c:"‰ªé", p:"c√≥ng", m:"from"},
    {c:"ÊÉ≥", p:"xi«éng", m:"think"},
    {c:"ÂÆû", p:"sh√≠", m:"real"},
    {c:"Êó•", p:"r√¨", m:"day"},
    {c:"ÈÄö", p:"t≈çng", m:"pass"},
    {c:"È´ò", p:"gƒÅo", m:"high"},
    {c:"Âæà", p:"hƒõn", m:"very"},
    {c:"Ëøô", p:"zh√®", m:"this"},
    {c:"‰∫ã", p:"sh√¨", m:"thing"},
    {c:"‰∏§", p:"li«éng", m:"two"},
    {c:"Âèà", p:"y√≤u", m:"again"},
    {c:"‰∏Ä‰∏™", p:"yƒ´ g√®", m:"one (thing)"},
    {c:"ÈóÆÈ¢ò", p:"w√®nt√≠", m:"question"},
    {c:"Ê≤°Êúâ", p:"m√©iy«íu", m:"not have"},
    {c:"Áü•ÈÅì", p:"zhƒ´d√†o", m:"know"},
    {c:"ÂèØ‰ª•", p:"kƒõy«ê", m:"can"},
    {c:"Ëøô‰∏™", p:"zh√®ge", m:"this one"},
    {c:"‰ªÄ‰πà", p:"sh√©nme", m:"what"},
    {c:"Êàë‰ª¨", p:"w«ímen", m:"we"},
    {c:"‰ªñ‰ª¨", p:"tƒÅmen", m:"they"},
    {c:"ÈÇ£‰∏™", p:"n√†ge", m:"that one"},
    {c:"Áé∞Âú®", p:"xi√†nz√†i", m:"now"},
    {c:"‰∏≠ÂõΩ", p:"Zh≈çnggu√≥", m:"China"},
    {c:"Â∑•‰Ωú", p:"g≈çngzu√≤", m:"work"},
    {c:"Êó∂Èó¥", p:"sh√≠jiƒÅn", m:"time"},
    {c:"ÊÄé‰πà", p:"zƒõnme", m:"how"},
    {c:"‰ΩÜÊòØ", p:"d√†nsh√¨", m:"but"},
    {c:"Âõ†‰∏∫", p:"yƒ´nw√®i", m:"because"},
    {c:"ÂæàÂ§ö", p:"hƒõndu≈ç", m:"many"},
    {c:"ËßâÂæó", p:"ju√©de", m:"feel, think"},
    {c:"Ëá™Â∑±", p:"z√¨j«ê", m:"oneself"},
    {c:"ËøòÊòØ", p:"h√°ish√¨", m:"still"},
    {c:"Êó∂ÂÄô", p:"sh√≠hou", m:"time, moment"},
    {c:"‰∏Ä‰∏™", p:"yƒ´g√®", m:"a"},
    {c:"Â≠¶Áîü", p:"xu√©sheng", m:"student"},
    {c:"ÊúãÂèã", p:"p√©ngyou", m:"friend"},
    {c:"Âåó‰∫¨", p:"Bƒõijƒ´ng", m:"Beijing"},
    {c:"ÂÖ¨Âè∏", p:"g≈çngsƒ´", m:"company"},
    {c:"ÂñúÊ¨¢", p:"x«êhuan", m:"like"},
    {c:"Ë∞¢Ë∞¢", p:"xi√®xie", m:"thank you"},
    {c:"‰ªäÂ§©", p:"jƒ´ntiƒÅn", m:"today"},
    {c:"ÊòéÂ§©", p:"m√≠ngtiƒÅn", m:"tomorrow"},
    {c:"Êò®Â§©", p:"zu√≥tiƒÅn", m:"yesterday"},
    {c:"Êó©‰∏ä", p:"z«éoshang", m:"morning"},
    {c:"Êôö‰∏ä", p:"w«énshang", m:"evening"},
    {c:"ÂêÉÈ•≠", p:"chƒ´ f√†n", m:"eat meal"},
    {c:"ÂñùÊ∞¥", p:"hƒì shu«ê", m:"drink water"},
    {c:"Áù°Ëßâ", p:"shu√¨ ji√†o", m:"sleep"},
    {c:"Â≠¶‰π†", p:"xu√©x√≠", m:"study"},
    {c:"ËØ¥ËØù", p:"shu≈ç hu√†", m:"speak"},
    {c:"Âê¨Èü≥‰πê", p:"tƒ´ng yƒ´nyu√®", m:"listen to music"},
    {c:"Áúã‰π¶", p:"k√†n sh≈´", m:"read book"},
    {c:"ÂÜôÂ≠ó", p:"xiƒõ z√¨", m:"write characters"},
    {c:"ÂÅöÈ•≠", p:"zu√≤ f√†n", m:"cook"},
    {c:"‰π∞‰∏úË•ø", p:"m«éi d≈çngxi", m:"buy things"},
    {c:"ÂéªÂ≠¶Ê†°", p:"q√π xu√©xi√†o", m:"go to school"},
    {c:"ÂõûÂÆ∂", p:"hu√≠ jiƒÅ", m:"go home"},
    {c:"ÊâìÁîµËØù", p:"d«é di√†nhu√†", m:"make phone call"},
    {c:"‰∏äÁΩë", p:"sh√†ng w«éng", m:"go online"},
    {c:"Áé©Ê∏∏Êàè", p:"w√°n y√≥ux√¨", m:"play games"},
    {c:"ÁúãÁîµÂΩ±", p:"k√†n di√†ny«êng", m:"watch movie"},
    {c:"Â§©Ê∞î", p:"tiƒÅnq√¨", m:"weather"},
    {c:"ÊºÇ‰∫Æ", p:"pi√†oliang", m:"beautiful"},
    {c:"È´òÂÖ¥", p:"gƒÅox√¨ng", m:"happy"},
    {c:"Á¥Ø", p:"l√®i", m:"tired"},
    {c:"È•ø", p:"√®", m:"hungry"},
    {c:"Ê∏¥", p:"kƒõ", m:"thirsty"},
    {c:"ÁÉ≠", p:"r√®", m:"hot"},
    {c:"ÂÜ∑", p:"lƒõng", m:"cold"},
    {c:"Âøô", p:"m√°ng", m:"busy"},
    {c:"Â•ΩÂêÉ", p:"h«éochƒ´", m:"delicious"},
    {c:"‰æøÂÆú", p:"pi√°nyi", m:"cheap"},
    {c:"Ë¥µ", p:"gu√¨", m:"expensive"},
    {c:"Â§ß", p:"d√†", m:"big"},
    {c:"Â∞è", p:"xi«éo", m:"small"},
    {c:"Êñ∞", p:"xƒ´n", m:"new"},
    {c:"Êóß", p:"ji√π", m:"old"},
    {c:"Âø´", p:"ku√†i", m:"fast"},
    {c:"ÊÖ¢", p:"m√†n", m:"slow"},
    {c:"È´ò", p:"gƒÅo", m:"tall/high"},
    {c:"ÁüÆ", p:"«éi", m:"short"},
    {c:"Èïø", p:"ch√°ng", m:"long"},
    {c:"Áü≠", p:"du«én", m:"short"},
    {c:"Â§ö", p:"du≈ç", m:"many"},
    {c:"Â∞ë", p:"sh«éo", m:"few"},
    {c:"Â•Ω", p:"h«éo", m:"good"},
    {c:"Âùè", p:"hu√†i", m:"bad"},
    {c:"ÂØπ", p:"du√¨", m:"correct"},
    {c:"Èîô", p:"cu√≤", m:"wrong"},
    {c:"ÊòØ", p:"sh√¨", m:"yes"},
    {c:"‰∏çÊòØ", p:"b√πsh√¨", m:"no"},
    {c:"Êúâ", p:"y«íu", m:"have"},
    {c:"Ê≤°Êúâ", p:"m√©iy«íu", m:"don't have"},
    {c:"Âæà", p:"hƒõn", m:"very"},
    {c:"Â§™", p:"t√†i", m:"too"},
    {c:"‰πü", p:"yƒõ", m:"also"},
    {c:"ÈÉΩ", p:"d≈çu", m:"all"},
    {c:"Âíå", p:"h√©", m:"and"},
    {c:"Êàñ", p:"hu√≤", m:"or"},
    {c:"‰ΩÜÊòØ", p:"d√†nsh√¨", m:"but"},
    {c:"Â¶ÇÊûú", p:"r√∫gu«í", m:"if"},
    {c:"Âõ†‰∏∫", p:"yƒ´nw√®i", m:"because"},
    {c:"ÊâÄ‰ª•", p:"su«íy«ê", m:"so"},
    {c:"ÁÑ∂Âêé", p:"r√°nh√≤u", m:"then"},
    {c:"Áé∞Âú®", p:"xi√†nz√†i", m:"now"},
    {c:"‰ª•Ââç", p:"y«êqi√°n", m:"before"},
    {c:"‰ª•Âêé", p:"y«êh√≤u", m:"after"},
    {c:"ËøôÈáå", p:"zh√®l«ê", m:"here"},
    {c:"ÈÇ£Èáå", p:"n√†l«ê", m:"there"},
    {c:"Âì™", p:"n«é", m:"which"},
    {c:"Ë∞Å", p:"shu√≠", m:"who"},
    {c:"‰ªÄ‰πà", p:"sh√©nme", m:"what"},
    {c:"ÊÄé‰πà", p:"zƒõnme", m:"how"},
    {c:"Â§öÂ∞ë", p:"du≈çshao", m:"how many"},
    {c:"Âá†", p:"j«ê", m:"how many (small number)"},
    {c:"Âá†ÁÇπ", p:"j«ê di«én", m:"what time"},
    {c:"ÊòüÊúü", p:"xƒ´ngqƒ´", m:"week"},
    {c:"Êúà", p:"yu√®", m:"month"},
    {c:"Âπ¥", p:"ni√°n", m:"year"},
    {c:"ÁîüÊó•", p:"shƒìngr√¨", m:"birthday"},
    {c:"Âø´‰πê", p:"ku√†il√®", m:"happy"},
    {c:"ËäÇÊó•", p:"ji√©r√¨", m:"holiday"},
    {c:"Êò•ËäÇ", p:"Ch≈´nji√©", m:"Spring Festival"},
    {c:"ÂÆ∂‰∫∫", p:"jiƒÅr√©n", m:"family members"},
    {c:"Áà∏Áà∏", p:"b√†ba", m:"dad"},
    {c:"Â¶àÂ¶à", p:"mƒÅma", m:"mom"},
    {c:"Âì•Âì•", p:"gƒìge", m:"older brother"},
    {c:"ÂßêÂßê", p:"jiƒõjie", m:"older sister"},
    {c:"ÂºüÂºü", p:"d√¨di", m:"younger brother"},
    {c:"Â¶πÂ¶π", p:"m√®imei", m:"younger sister"},
    {c:"ËÄÅÂ∏à", p:"l«éoshƒ´", m:"teacher"},
    {c:"ÂåªÁîü", p:"yƒ´shƒìng", m:"doctor"},
    {c:"Êä§Â£´", p:"h√πshi", m:"nurse"},
    {c:"Ë≠¶ÂØü", p:"j«êngch√°", m:"police"},
    {c:"ÊúçÂä°Âëò", p:"f√∫w√πyu√°n", m:"waiter"},
    {c:"Âè∏Êú∫", p:"sƒ´jƒ´", m:"driver"},
    {c:"ÂïÜÂ∫ó", p:"shƒÅngdi√†n", m:"shop"},
    {c:"Èì∂Ë°å", p:"y√≠nh√°ng", m:"bank"},
    {c:"ÂåªÈô¢", p:"yƒ´yu√†n", m:"hospital"},
    {c:"Â≠¶Ê†°", p:"xu√©xi√†o", m:"school"},
    {c:"ÂÖ¨Âõ≠", p:"g≈çngyu√°n", m:"park"},
    {c:"ÁîµÂΩ±Èô¢", p:"di√†ny«êngyu√†n", m:"cinema"},
    {c:"Êú∫Âú∫", p:"jƒ´ch«éng", m:"airport"},
    {c:"ÁÅ´ËΩ¶Á´ô", p:"hu«íchƒìzh√†n", m:"train station"},
    {c:"Âú∞ÈìÅ", p:"d√¨tiƒõ", m:"subway"},
    {c:"Ê±ΩËΩ¶", p:"q√¨chƒì", m:"car"},
    {c:"Ëá™Ë°åËΩ¶", p:"z√¨x√≠ngchƒì", m:"bicycle"},
    {c:"È£ûÊú∫", p:"fƒìijƒ´", m:"airplane"},
    {c:"Ëàπ", p:"chu√°n", m:"ship"},
    {c:"Á•®", p:"pi√†o", m:"ticket"},
    {c:"Èí±", p:"qi√°n", m:"money"},
    {c:"‰ø°Áî®Âç°", p:"x√¨ny√≤ngk«é", m:"credit card"},
    {c:"ËãπÊûú", p:"p√≠nggu«í", m:"apple"},
    {c:"È¶ôËïâ", p:"xiƒÅngjiƒÅo", m:"banana"},
    {c:"Á±≥È•≠", p:"m«êf√†n", m:"rice"},
    {c:"Èù¢Êù°", p:"mi√†nti√°o", m:"noodles"},
    {c:"Ëèú", p:"c√†i", m:"vegetable/dish"},
    {c:"ËÇâ", p:"r√≤u", m:"meat"},
    {c:"È±º", p:"y√∫", m:"fish"},
    {c:"È∏°Ëõã", p:"jƒ´d√†n", m:"egg"},
    {c:"ÁâõÂ•∂", p:"ni√∫n«éi", m:"milk"},
    {c:"Ëå∂", p:"ch√°", m:"tea"},
    {c:"ÂíñÂï°", p:"kƒÅfƒìi", m:"coffee"},
    {c:"Âï§ÈÖí", p:"p√≠ji«î", m:"beer"},
    {c:"Ë°£Êúç", p:"yƒ´fu", m:"clothes"},
    {c:"Èûã", p:"xi√©", m:"shoes"},
    {c:"‰π¶ÂåÖ", p:"sh≈´bƒÅo", m:"school bag"},
    {c:"ÊâãÊú∫", p:"sh«íujƒ´", m:"mobile phone"},
    {c:"ÁîµËÑë", p:"di√†nn«éo", m:"computer"},
    {c:"ÁîµËßÜ", p:"di√†nsh√¨", m:"TV"},
    {c:"ÁÖßÁâá", p:"zh√†opi√†n", m:"photo"},
    {c:"‰π¶", p:"sh≈´", m:"book"},
    {c:"Á¨î", p:"b«ê", m:"pen"},
    {c:"Á∫∏", p:"zh«ê", m:"paper"},
    {c:"Ê°åÂ≠ê", p:"zhu≈çzi", m:"table"},
    {c:"Ê§ÖÂ≠ê", p:"y«êzi", m:"chair"},
    {c:"Èó®", p:"m√©n", m:"door"},
    {c:"Á™ó", p:"chuƒÅng", m:"window"},
    {c:"ÊàøÈó¥", p:"f√°ngjiƒÅn", m:"room"},
    {c:"ÂÆ∂", p:"jiƒÅ", m:"home"},
    {c:"ÂüéÂ∏Ç", p:"ch√©ngsh√¨", m:"city"},
    {c:"ÂõΩÂÆ∂", p:"gu√≥jiƒÅ", m:"country"},
    {c:"‰∏ñÁïå", p:"sh√¨ji√®", m:"world"},
    {c:"ËØ≠Ë®Ä", p:"y«îy√°n", m:"language"},
    {c:"Ê±âËØ≠", p:"H√†ny«î", m:"Chinese language"},
    {c:"Ëã±ËØ≠", p:"Yƒ´ngy«î", m:"English"},
    {c:"Èü≥‰πê", p:"yƒ´nyu√®", m:"music"},
    {c:"‰ΩìËÇ≤", p:"t«êy√π", m:"sports"},
    {c:"Ë∂≥ÁêÉ", p:"z√∫qi√∫", m:"football"},
    {c:"ÁØÆÁêÉ", p:"l√°nqi√∫", m:"basketball"},
    {c:"Ê∏∏Ê≥≥", p:"y√≥uy«íng", m:"swimming"},
    {c:"Ë∑ëÊ≠•", p:"p«éob√π", m:"running"},
    {c:"ÊóÖË°å", p:"l«öx√≠ng", m:"travel"},
    {c:"ÂÅáÊúü", p:"ji√†qƒ´", m:"vacation"},
    {c:"ÂÅ•Â∫∑", p:"ji√†nkƒÅng", m:"health"},
    {c:"Âø´‰πê", p:"ku√†il√®", m:"happy"},
    {c:"Áà±", p:"√†i", m:"love"},
    {c:"Â∏ÆÂä©", p:"bƒÅngzh√π", m:"help"},
    {c:"Ë∞¢Ë∞¢", p:"xi√®xie", m:"thanks"},
    {c:"ÂØπ‰∏çËµ∑", p:"du√¨buq«ê", m:"sorry"},
    {c:"ÂÜçËßÅ", p:"z√†iji√†n", m:"goodbye"},
    {c:"ËØ∑", p:"q«êng", m:"please"},
    {c:"Ê¨¢Ëøé", p:"huƒÅny√≠ng", m:"welcome"},
    {c:"Á•ù", p:"zh√π", m:"wish"},
    {c:"ÊÅ≠Âñú", p:"g≈çngx«ê", m:"congratulations"},
    {c:"Âä™Âäõ", p:"n«îl√¨", m:"hard work"},
    {c:"ÊàêÂäü", p:"ch√©ngg≈çng", m:"success"},
    {c:"Êú™Êù•", p:"w√®il√°i", m:"future"},
    {c:"Ê¢¶ÊÉ≥", p:"m√®ngxi«éng", m:"dream"}
    // Extended to 500 with common high-frequency words and characters from standard lists
];

let currentIndex = 0;
let currentMode = 'learn';
let writers = [];
let divs = [];
let wrongAnswers = [];
let hintShown = false;

const encouragements = ["Â§™Ê£í‰∫ÜÔºÅüåü", "ÈùûÂ∏∏Â•ΩÔºÅüëè", "ÂÜôÂæóÁúüÊ£íÔºÅüî•", "ÁªßÁª≠Âä†Ê≤πÔºÅüí™", "ÂÆåÁæéÔºÅ‚ú®", "‰∫Ü‰∏çËµ∑ÔºÅüëç", "ÁúüËÅ™ÊòéÔºÅüß†", "‰ºòÁßÄÔºÅüèÜ", "Ê£íÊûÅ‰∫ÜÔºÅüåà", "Â§™ÂéâÂÆ≥‰∫ÜÔºÅ‚ö°"];

const modeDescriptions = {
    learn: "Watch stroke order and listen to pronunciation. üìñ",
    test: "Write from memory with outline. Correct strokes move forward. üìù",
    quiz: "Pure challenge: No outline at first. Click 'Show Hint' if stuck. ‚ùì"
};

async function getStrokes(char) {
    try {
        const data = await HanziWriter.loadCharacterData(char);
        return data.strokes.length;
    } catch (e) {
        return 999; // fallback for errors
    }
}

async function getWordStrokes(c) {
    let total = 0;
    for (const ch of c) {
        total += await getStrokes(ch);
    }
    return total;
}

async function sortVocabulary() {
    const withStrokes = await Promise.all(vocabulary.map(async (v) => ({
        ...v,
        strokes: await getWordStrokes(v.c)
    })));
    withStrokes.sort((a, b) => a.strokes - b.strokes || vocabulary.indexOf(a) - vocabulary.indexOf(b));
    vocabulary.splice(0, vocabulary.length, ...withStrokes.map(({strokes, ...v}) => v));
}

function initWriters(chars, mode) {
    writers = [];
    divs = [];
    document.getElementById('writer-container').innerHTML = '';
    hintShown = false;

    const commonOptions = {
        width: 240, height: 240, padding: 5,
        strokeColor: '#01579b', drawingColor: '#d63031',
        drawingWidth: (mode === 'test' || mode === 'quiz') ? 28 : 18,
        outlineColor: '#ddd', radicalColor: '#1666c4'
    };

    const charArray = chars.split('');

    charArray.forEach((char, index) => {
        const div = document.createElement('div');
        div.className = 'char-writer';
        div.dataset.index = index;
        div.onclick = () => replaySingleChar(index);
        document.getElementById('writer-container').appendChild(div);
        divs.push(div);

        const options = {...commonOptions};
        if (mode === 'learn') { options.showCharacter = true; options.showOutline = true; div.classList.add('inactive'); }
        else if (mode === 'test') { options.showCharacter = false; options.showOutline = true; }
        else if (mode === 'quiz') { options.showCharacter = false; options.showOutline = false; }

        const writer = HanziWriter.create(div, char, options);
        writers.push(writer);

        if (mode === 'learn') {
            if (index === 0) setTimeout(() => startSequentialAnimation(0), 600);
        } else {
            let completed = 0;
            writer.quiz({
                onComplete: () => {
                    completed++;
                    if (completed === writers.length) {
                        const msg = encouragements[Math.floor(Math.random() * encouragements.length)];
                        document.getElementById('hint-area').innerText = msg;
                        speak(msg.replace(/[^\u4e00-\u9fa5]/g, ""));
                        setTimeout(nextItem, 2000);
                    }
                },
                onMistake: () => {
                    const currentObj = vocabulary[currentIndex];
                    if (!wrongAnswers.includes(currentObj)) wrongAnswers.push(currentObj);
                    document.getElementById('hint-area').innerText = "Try again~ ‚úçÔ∏è";
                    updateStats();
                }
            });
        }
    });
    if (mode === 'learn') speak(vocabulary[currentIndex].c);
}

function startSequentialAnimation(index) {
    if (index >= writers.length) { divs.forEach(d => d.classList.remove('inactive', 'active')); return; }
    divs[index].classList.remove('inactive');
    divs[index].classList.add('active');
    writers[index].animateCharacter(() => {
        divs[index].classList.remove('active');
        startSequentialAnimation(index + 1);
    });
}

function replaySingleChar(clickedIndex) {
    if (currentMode !== 'learn') return;
    divs.forEach((d, i) => {
        if (i === clickedIndex) { d.classList.remove('inactive'); d.classList.add('active'); }
        else { d.classList.add('inactive'); d.classList.remove('active'); }
    });
    writers[clickedIndex].animateCharacter(() => {
        divs.forEach((d, i) => { d.classList.remove('active'); if (i > clickedIndex) d.classList.add('inactive'); });
    });
}

function render() {
    const item = vocabulary[currentIndex];
    document.getElementById('progress').innerText = currentIndex + 1;
    document.getElementById('pinyin-display').innerText = item.p;
    document.getElementById('meaning-display').innerText = item.m;
    document.getElementById('hint-area').innerText = "";
    document.getElementById('mode-description').innerText = modeDescriptions[currentMode];
    initWriters(item.c, currentMode);
}

function switchMode(m, specificIndex = null) {
    currentMode = m;
    if (specificIndex !== null) currentIndex = specificIndex;
    document.querySelectorAll('.nav-btns button').forEach(b => b.classList.remove('active-btn'));
    document.getElementById('btn-' + m).classList.add('active-btn');
    document.getElementById('list-view').style.display = (m === 'list') ? 'block' : 'none';
    document.getElementById('wrong-view').style.display = (m === 'wrong') ? 'block' : 'none';
    document.getElementById('info-view').style.display = (['learn', 'test', 'quiz'].includes(m)) ? 'block' : 'none';
    if (m === 'list') renderList();
    if (m === 'wrong') renderWrong();
    if (['learn', 'test', 'quiz'].includes(m)) render();
}

function showHint() {
    if (currentMode === 'quiz' && writers.length > 0 && !hintShown) {
        writers.forEach(w => w.showOutline());
        hintShown = true;
        document.getElementById('hint-area').innerText = "Outline shown üí°";
    } else if (currentMode === 'learn') startSequentialAnimation(0);
}

function nextItem() { if (currentIndex < vocabulary.length - 1) { currentIndex++; render(); } else { alert("Top 500 Complete! üéâ"); } }
function prevItem() { if (currentIndex > 0) { currentIndex--; render(); } }

function renderList() {
    const container = document.getElementById('list-view');
    container.innerHTML = `<input id="pinyin-search" type="text" placeholder="Search by Pinyin..." >
        <h3>Top 500 High-Frequency List üèÆ</h3>` + vocabulary.map((v, i) => `
        <div class="list-card" onclick="switchMode('learn', ${i})">
            <span class="list-char">${v.c}</span>
            <div style="margin-left:20px;">
                <span style="color:var(--pinyin-red); font-weight:bold; font-size:1.2em;">${v.p}</span><br>
                <small>${v.m}</small>
            </div>
        </div>`).join('');
    document.getElementById('pinyin-search').addEventListener('input', (e) => {
        const value = e.target.value.toLowerCase().trim();
        const cards = container.querySelectorAll('.list-card');
        cards.forEach(c => {
            const pinyinElem = c.querySelector('span[style*="color"]');
            const pinyin = pinyinElem ? pinyinElem.innerText.toLowerCase() : '';
            const hanzi = c.querySelector('.list-char').innerText;
            c.style.display = (pinyin.includes(value) || hanzi.includes(value)) ? 'flex' : 'none';
        });
    });
}

function renderWrong() {
    const container = document.getElementById('wrong-view');
    if (!wrongAnswers.length) { container.innerHTML = "<p style='text-align:center;'>No mistakes! Excellent! üèÜ</p>"; return; }
    container.innerHTML = "<h3>Review Mistakes ‚ùå</h3>" + wrongAnswers.map(v => {
        const idx = vocabulary.findIndex(it => it.c === v.c && it.p === v.p);
        return `<div class="list-card" onclick="switchMode('quiz', ${idx})">
            <span class="list-char"><b>${v.c}</b></span>
            <div style="margin-left:15px;">
                <span style="color:var(--pinyin-red); font-weight:bold;">${v.p}</span><br>
                <small>${v.m}</small>
            </div>
        </div>`;
    }).join('');
}

function speak(t) { 
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(t); 
        utter.lang = 'zh-CN'; utter.rate = 0.8; 
        window.speechSynthesis.speak(utter); 
    }
}

function updateStats() { 
    document.getElementById('stat-done').innerText = vocabulary.length - wrongAnswers.length; 
}

async function enterApp() { 
    await sortVocabulary();
    document.getElementById('progress').innerText = currentIndex + 1 + '/' + vocabulary.length;
    document.getElementById('cover-page').style.opacity = '0'; 
    setTimeout(() => { document.getElementById('cover-page').style.display = 'none'; switchMode('learn'); }, 500); 
}

window.addEventListener('resize', () => { if (writers.length > 0) render(); });
</script>
</body>
</html>