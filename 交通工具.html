<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁîüËØçÊ®°Âºè - 40Áßç‰∫§ÈÄöÂ∑•ÂÖ∑</title>
    <style>
        :root {
            --primary-blue: #2980b9;
            --dark-gray: #2c3e50;
            --accent-orange: #f39c12;
            --bg-light: #ffffff;
            --text-black: #1a1a1a;
            --correct-green: #2ecc71;
            --wrong-red: #e74c3c;
            --pinyin-gray: #999;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif, 'Microsoft YaHei';
            background-color: var(--bg-light);
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100vw; height: 100vh; max-width: 600px; background: white; 
            padding: 1rem; box-sizing: border-box; display: flex; flex-direction: column;
        }

        .nav-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; 
            margin-bottom: 10px; flex-shrink: 0; z-index: 100;
        }
        .nav-grid button { 
            font-size: 0.75rem; padding: 10px 2px; background: #f5f5f5; 
            border-radius: 8px; border: none; color: #666; cursor: pointer; font-weight: bold; 
        }
        .nav-grid button.active { background: var(--dark-gray); color: white; }

        .card-scene { flex-grow: 1; perspective: 1000px; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s; transform-style: preserve-3d; cursor: pointer; }
        .card.is-flipped { transform: rotateY(180deg); }
        .card.is-switching { opacity: 0; }
        
        .card-face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            display: flex; flex-direction: column; align-items: center; 
            background: white; text-align: center;
            padding: 18vh 20px 20px 20px;
            box-sizing: border-box;
        }
        
        .card-back { transform: rotateY(180deg); background: #fafafa; border-radius: 24px; padding-top: 10vh; }

        .emoji-huge { font-size: 7.5rem; margin-bottom: 10px; }
        .word-huge { font-size: 5rem; font-weight: 900; color: var(--text-black); line-height: 1; }
        .word-en-huge { font-size: 3.5rem; font-weight: 800; color: var(--primary-blue); line-height: 1.1; margin-top: 5vh; }
        
        .word-ruby { font-size: 3.5rem; font-weight: 900; color: var(--text-black); margin: 0; line-height: 1.2;}
        .ex-ruby { font-size: 1.4rem; font-weight: bold; color: var(--text-black); line-height: 2.2; margin-bottom: 15px; }
        rt { font-size: 0.85rem; color: var(--pinyin-gray); font-weight: normal; transform: translateY(-2px); }
        
        .back-eng-title { font-size: 2rem; font-weight: bold; color: var(--accent-orange); margin: 10px 0 30px 0; }
        .ex-container { width: 100%; padding-top: 25px; border-top: 1px solid #eee; margin-top: auto; padding-bottom: 5vh;}
        .ex-en { font-size: 1.1rem; color: #777; font-style: italic; line-height: 1.2; padding: 0 10px; }

        #progress-tag { position: absolute; top: -5px; left: 0; font-size: 0.85rem; color: #eee; font-weight: bold; }

        .opt-btn { display: block; width: 100%; padding: 16px; margin: 8px 0; border: 1px solid #eee; background: white; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .opt-btn.correct { background-color: var(--correct-green) !important; color: white; border-color: var(--correct-green); }
        .opt-btn.wrong { background-color: var(--wrong-red) !important; color: white; border-color: var(--wrong-red); animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }

        #summary-container { flex-grow: 1; overflow-y: auto; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f9f9f9; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app">
    <div class="nav-grid" id="nav-btns">
        <button onclick="startMode('learn')">LEARN</button>
        <button onclick="startMode('card-cn')">CARD(CN)</button>
        <button onclick="startMode('card-en')">CARD(EN)</button>
        <button onclick="startMode('quiz')">QUIZ</button>
        <button onclick="startMode('timed')">RUSH</button>
        <button onclick="startMode('summary')">LIST</button>
    </div>

    <div id="card-container" class="mode-view">
        <div id="progress-tag">01/40</div>
        <div class="card-scene">
            <div class="card" id="display-card" onclick="handleCardClick()">
                <div class="card-face card-front" id="card-f"></div>
                <div class="card-face card-back" id="card-b"></div>
            </div>
        </div>
    </div>

    <div id="summary-container" class="mode-view hidden"><div id="summary-list"></div></div>

    <div id="quiz-container" class="mode-view hidden" style="flex-grow:1; padding:20px; text-align:center;">
        <div style="display:flex; justify-content:space-between; font-weight:bold; color:#ddd; margin-bottom:10px;">
            <span id="quiz-score-tag">SCORE: 0</span>
            <span id="quiz-timer-tag"></span>
        </div>
        <div id="quiz-q" style="font-size:2.5rem; font-weight:bold; margin: 20px 0; color:var(--primary-blue);"></div>
        <div id="quiz-opts"></div>
    </div>
</div>

<script>
    const vocabulary = [
        { word: "È£ûÊú∫", pinyin: "fƒìi jƒ´", eng: "Airplane", emoji: "‚úàÔ∏è", exZh: "ÊàëÂùêÈ£ûÊú∫ÂéªÂåó‰∫¨„ÄÇ", exPy: "w«í zu√≤ fƒìi jƒ´ q√π bƒõi jƒ´ng", exEn: "I take an airplane to Beijing." },
        { word: "Áõ¥ÂçáÊú∫", pinyin: "zh√≠ shƒìng jƒ´", eng: "Helicopter", emoji: "üöÅ", exZh: "Áõ¥ÂçáÊú∫Âú®Á©∫‰∏≠ÁõòÊóã„ÄÇ", exPy: "zh√≠ shƒìng jƒ´ z√†i k≈çng zh≈çng p√°n xu√°n", exEn: "The helicopter is circling in the air." },
        { word: "Ëá™Ë°åËΩ¶", pinyin: "z√¨ x√≠ng chƒì", eng: "Bicycle", emoji: "üö≤", exZh: "‰ªñÊØèÂ§©È™ëËá™Ë°åËΩ¶‰∏äÁè≠„ÄÇ", exPy: "tƒÅ mƒõi tiƒÅn q√≠ z√¨ x√≠ng chƒì sh√†ng bƒÅn", exEn: "He rides a bicycle to work every day." },
        { word: "ÂÖ¨ÂÖ±Ê±ΩËΩ¶", pinyin: "g≈çng g√≤ng q√¨ chƒì", eng: "Bus", emoji: "üöå", exZh: "Êàë‰ª¨Ë¶ÅÁ≠âÂÖ¨ÂÖ±Ê±ΩËΩ¶„ÄÇ", exPy: "w«í men y√†o dƒõng g≈çng g√≤ng q√¨ chƒì", exEn: "We need to wait for the bus." },
        { word: "Âá∫ÁßüËΩ¶", pinyin: "ch≈´ z≈´ chƒì", eng: "Taxi", emoji: "üöï", exZh: "‰∏ãÈõ®Êó∂ÂæàÈöæÂè´Âà∞Âá∫ÁßüËΩ¶„ÄÇ", exPy: "xi√† y«î sh√≠ hƒõn n√°n ji√†o d√†o ch≈´ z≈´ chƒì", exEn: "It is hard to catch a taxi when it rains." },
        { word: "ÁÅ´ËΩ¶", pinyin: "hu«í chƒì", eng: "Train", emoji: "üöÇ", exZh: "ÁÅ´ËΩ¶ÁöÑÈÄüÂ∫¶ÈùûÂ∏∏Âø´„ÄÇ", exPy: "hu«í chƒì de s√π d√π fƒìi ch√°ng ku√†i", exEn: "The train's speed is very fast." },
        { word: "Âú∞ÈìÅ", pinyin: "d√¨ tiƒõ", eng: "Subway", emoji: "üöá", exZh: "ÂùêÂú∞ÈìÅ‰∏ç‰ºöÂ†µËΩ¶„ÄÇ", exPy: "zu√≤ d√¨ tiƒõ b√∫ hu√¨ d«î chƒì", exEn: "Taking the subway avoids traffic jams." },
        { word: "Êë©ÊâòËΩ¶", pinyin: "m√≥ tu≈ç chƒì", eng: "Motorcycle", emoji: "üèçÔ∏è", exZh: "È™ëÊë©ÊâòËΩ¶Ë¶ÅÊà¥Â§¥Áõî„ÄÇ", exPy: "q√≠ m√≥ tu≈ç chƒì y√†o d√†i t√≥u kuƒ´", exEn: "You must wear a helmet when riding a motorcycle." },
        { word: "ËΩÆËàπ", pinyin: "l√∫n chu√°n", eng: "Ship", emoji: "üö¢", exZh: "ËΩÆËàπÂú®Â§ßÊµ∑‰∏äËà™Ë°å„ÄÇ", exPy: "l√∫n chu√°n z√†i d√† h«éi sh√†ng h√°ng x√≠ng", exEn: "The ship is sailing on the sea." },
        { word: "Â∏ÜËàπ", pinyin: "fƒÅn chu√°n", eng: "Sailboat", emoji: "‚õµ", exZh: "Â∏ÜËàπÈù†È£éÂäõÂâçËøõ„ÄÇ", exPy: "fƒÅn chu√°n k√†o fƒìng l√¨ qi√°n j√¨n", exEn: "Sailboats move by wind power." },
        { word: "ÊïëÊä§ËΩ¶", pinyin: "ji√π h√π chƒì", eng: "Ambulance", emoji: "üöë", exZh: "ËØ∑ÁªôÊïëÊä§ËΩ¶ËÆ©Ë∑Ø„ÄÇ", exPy: "q«êng gƒõi ji√π h√π chƒì r√†ng l√π", exEn: "Please make way for the ambulance." },
        { word: "Ë≠¶ËΩ¶", pinyin: "j«êng chƒì", eng: "Police Car", emoji: "üöì", exZh: "Ë≠¶ËΩ¶Ê≠£Âú®ÊâßË°å‰ªªÂä°„ÄÇ", exPy: "j«êng chƒì zh√®ng z√†i zh√≠ x√≠ng r√®n wu", exEn: "The police car is on a mission." },
        { word: "Ê∂àÈò≤ËΩ¶", pinyin: "xiƒÅo f√°ng chƒì", eng: "Fire Engine", emoji: "üöí", exZh: "Ê∂àÈò≤ËΩ¶Ëµ∂ÂæÄÁÅ´ÁÅæÁé∞Âú∫„ÄÇ", exPy: "xiƒÅo f√°ng chƒì g«én w«éng hu«í zƒÅi xi√†n ch«éng", exEn: "The fire engine is rushing to the fire scene." },
        { word: "Âç°ËΩ¶", pinyin: "k«é chƒì", eng: "Truck", emoji: "üöõ", exZh: "Âç°ËΩ¶ËøêËΩΩÁùÄÂæàÂ§öË¥ßÁâ©„ÄÇ", exPy: "k«é chƒì y√πn z√†i zhe hƒõn du≈ç hu√≤ w√π", exEn: "The truck is carrying a lot of goods." },
        { word: "‰∏âËΩÆËΩ¶", pinyin: "sƒÅn l√∫n chƒì", eng: "Tricycle", emoji: "üõ∫", exZh: "ËÄÅÁà∑Áà∑È™ëÁùÄ‰∏âËΩÆËΩ¶„ÄÇ", exPy: "l«éo y√© ye q√≠ zhe sƒÅn l√∫n chƒì", exEn: "The grandfather is riding a tricycle." },
        { word: "ÁîµÂä®ËΩ¶", pinyin: "di√†n d√≤ng chƒì", eng: "Electric Scooter", emoji: "üõµ", exZh: "ÁîµÂä®ËΩ¶Âú®ÂüéÂ∏ÇÂæàÊñπ‰æø„ÄÇ", exPy: "di√†n d√≤ng chƒì z√†i ch√©ng sh√¨ hƒõn fƒÅng bi√†n", exEn: "Electric scooters are convenient in cities." },
        { word: "ÁÉ≠Ê∞îÁêÉ", pinyin: "r√® q√¨ qi√∫", eng: "Hot Air Balloon", emoji: "üéà", exZh: "ÁÉ≠Ê∞îÁêÉÁºìÁºìÂçáÁ©∫„ÄÇ", exPy: "r√® q√¨ qi√∫ hu«én hu«én shƒìng k≈çng", exEn: "The hot air balloon rose slowly." },
        { word: "ÁÅ´ÁÆ≠", pinyin: "hu«í ji√†n", eng: "Rocket", emoji: "üöÄ", exZh: "ÁÅ´ÁÆ≠ÊääÂç´ÊòüÈÄÅÂÖ•ËΩ®ÈÅì„ÄÇ", exPy: "hu«í ji√†n b«é w√®i xƒ´ng s√≤ng r√π gu«ê d√†o", exEn: "The rocket sent the satellite into orbit." },
        { word: "ÊãñÊãâÊú∫", pinyin: "tu≈ç lƒÅ jƒ´", eng: "Tractor", emoji: "üöú", exZh: "ÂÜúÊ∞ëÁî®ÊãñÊãâÊú∫ËÄïÂú∞„ÄÇ", exPy: "n√≥ng m√≠n y√≤ng tu≈ç lƒÅ jƒ´ gƒìng d√¨", exEn: "Farmers use tractors to plow the fields." },
        { word: "ÊΩúÊ∞¥Ëâá", pinyin: "qi√°n shu«ê t«êng", eng: "Submarine", emoji: "üö§", exZh: "ÊΩúÊ∞¥ËâáÂú®Ê∞¥‰∏ãÊΩúË°å„ÄÇ", exPy: "qi√°n shu«ê t«êng z√†i shu«ê xi√† qi√°n x√≠ng", exEn: "The submarine is cruising underwater." },
        { word: "ÊªëÊùø", pinyin: "hu√° b«én", eng: "Skateboard", emoji: "üõπ", exZh: "‰ªñÂú®ÂÖ¨Âõ≠Áé©ÊªëÊùø„ÄÇ", exPy: "tƒÅ z√†i g≈çng yu√°n w√°n hu√° b«én", exEn: "He is playing with a skateboard in the park." },
        { word: "Ê∫úÂÜ∞Èûã", pinyin: "li≈´ bƒ´ng xi√©", eng: "Roller Skates", emoji: "üõº", exZh: "ËøôÂØπÊ∫úÂÜ∞ÈûãÊòØËìùËâ≤ÁöÑ„ÄÇ", exPy: "zh√® du√¨ li≈´ bƒ´ng xi√© sh√¨ l√°n s√® de", exEn: "This pair of roller skates is blue." },
        { word: "ÁöÆÂàíËâá", pinyin: "p√≠ hu√° t«êng", eng: "Kayak", emoji: "üõ∂", exZh: "Êàë‰ª¨Âú®Ê≤≥ÈáåÂàíÁöÆÂàíËâá„ÄÇ", exPy: "w«í men z√†i h√© l«ê hu√° p√≠ hu√° t«êng", exEn: "We are paddling a kayak in the river." },
        { word: "ÁºÜËΩ¶", pinyin: "l«én chƒì", eng: "Cable Car", emoji: "üö†", exZh: "Êàë‰ª¨ÂùêÁºÜËΩ¶‰∏äÂ±±„ÄÇ", exPy: "w«í men zu√≤ l«én chƒì sh√†ng shƒÅn", exEn: "We took the cable car up the mountain." },
        { word: "ÊïëÁîüËâá", pinyin: "ji√π shƒìng t«êng", eng: "Lifeboat", emoji: "üö£", exZh: "Ëàπ‰∏äÊúâË∂≥Â§üÁöÑÊïëÁîüËâá„ÄÇ", exPy: "chu√°n sh√†ng y«íu z√∫ g√≤u de ji√π shƒìng t«êng", exEn: "There are enough lifeboats on the ship." },
        { word: "Â§ßÂ∑¥", pinyin: "d√† bƒÅ", eng: "Coach", emoji: "üöç", exZh: "ÈïøÈÄîÂ§ßÂ∑¥ÈùûÂ∏∏ËàíÈÄÇ„ÄÇ", exPy: "ch√°ng t√∫ d√† bƒÅ fƒìi ch√°ng sh≈´ sh√¨", exEn: "The long-distance coach is very comfortable." },
        { word: "ÂêâÊôÆËΩ¶", pinyin: "j√≠ p«î chƒì", eng: "Jeep", emoji: "üöô", exZh: "ÂêâÊôÆËΩ¶ÈÄÇÂêàË∂äÈáéË∑ØÊÆµ„ÄÇ", exPy: "j√≠ p«î chƒì sh√¨ h√© yu√® yƒõ l√π du√†n", exEn: "Jeeps are suitable for off-road sections." },
        { word: "ÊïëÁÅ´ËΩ¶", pinyin: "ji√π hu«í chƒì", eng: "Fire Truck", emoji: "üöí", exZh: "ÊïëÁÅ´ËΩ¶Ê≠£Âú®Ë≠¶Êä•È∏£Âìç„ÄÇ", exPy: "ji√π hu«í chƒì zh√®ng z√†i j«êng b√†o m√≠ng xi«éng", exEn: "The fire truck's siren is sounding." },
        { word: "Âù¶ÂÖã", pinyin: "t«én k√®", eng: "Tank", emoji: "üõ°Ô∏è", exZh: "Âù¶ÂÖãÁöÑË£ÖÁî≤ÂæàÂéö„ÄÇ", exPy: "t«én k√® de zhuƒÅng ji«é hƒõn h√≤u", exEn: "The tank's armor is very thick." },
        { word: "Âø´Ëâá", pinyin: "ku√†i t«êng", eng: "Speedboat", emoji: "üö§", exZh: "Âø´ËâáÂú®ÊπñÈù¢‰∏äÈ£ûÈ©∞„ÄÇ", exPy: "ku√†i t«êng z√†i h√∫ mi√†n sh√†ng fƒìi ch√≠", exEn: "The speedboat is speeding on the lake." },
        { word: "Ê†°ËΩ¶", pinyin: "xi√†o chƒì", eng: "School Bus", emoji: "üöå", exZh: "Ê†°ËΩ¶Êé•Â≠©Â≠ê‰ª¨‰∏äÂ≠¶„ÄÇ", exPy: "xi√†o chƒì jiƒì h√°i zi men sh√†ng xu√©", exEn: "The school bus picks up children for school." },
        { word: "ÊåñÊéòÊú∫", pinyin: "wƒÅ ju√© jƒ´", eng: "Excavator", emoji: "üèóÔ∏è", exZh: "ÊåñÊéòÊú∫Âú®Â∑•Âú∞‰∏äÂ∑•‰Ωú„ÄÇ", exPy: "wƒÅ ju√© jƒ´ z√†i g≈çng d√¨ sh√†ng g≈çng zu√≤", exEn: "The excavator is working on the construction site." },
        { word: "Áõ¥ÊéíËΩÆ", pinyin: "zh√≠ p√°i l√∫n", eng: "In-line Skates", emoji: "‚õ∏Ô∏è", exZh: "‰ªñÁ©ø‰∏äÁõ¥ÊéíËΩÆÈ£ûÂø´Âú∞Êªë„ÄÇ", exPy: "tƒÅ chuƒÅn sh√†ng zh√≠ p√°i l√∫n fƒìi ku√†i de hu√°", exEn: "He put on in-line skates and skated fast." },
        { word: "ÂçïËΩÆËΩ¶", pinyin: "dƒÅn l√∫n chƒì", eng: "Unicycle", emoji: "üé™", exZh: "Â∞è‰∏ëÂú®Ë°®ÊºîÂçïËΩÆËΩ¶„ÄÇ", exPy: "xi«éo ch«íu z√†i bi«éo y«én dƒÅn l√∫n chƒì", exEn: "The clown is performing on a unicycle." },
        { word: "ÊªëÁøî‰ºû", pinyin: "hu√° xi√°ng s«én", eng: "Paraglider", emoji: "ü™Ç", exZh: "‰ªñÂñúÊ¨¢Áé©ÊªëÁøî‰ºûËøêÂä®„ÄÇ", exPy: "tƒÅ x«ê huƒÅn w√°n hu√° xi√°ng s«én y√πn d√≤ng", exEn: "He likes to do paragliding." },
        { word: "ÂûÉÂúæËΩ¶", pinyin: "lƒÅ jƒ´ chƒì", eng: "Garbage Truck", emoji: "üóëÔ∏è", exZh: "ÂûÉÂúæËΩ¶ÊØèÂ§©Êó©‰∏äÊù•Êî∂ÂûÉÂúæ„ÄÇ", exPy: "lƒÅ jƒ´ chƒì mƒõi tiƒÅn z«éo shang l√°i sh≈çu lƒÅ jƒ´", exEn: "The garbage truck comes to collect trash every morning." },
        { word: "ËøêÈíûËΩ¶", pinyin: "y√πn chƒÅo chƒì", eng: "Armored Van", emoji: "üí∞", exZh: "ËøêÈíûËΩ¶ÂÅúÂú®Èì∂Ë°åÈó®Âè£„ÄÇ", exPy: "y√πn chƒÅo chƒì t√≠ng z√†i y√≠n h√°ng m√©n k«íu", exEn: "The armored van stopped at the bank entrance." },
        { word: "ÊâãÊé®ËΩ¶", pinyin: "sh«íu tuƒ´ chƒì", eng: "Wheelbarrow", emoji: "üõí", exZh: "Ë∂ÖÂ∏ÇÈáåÊúâÂæàÂ§öÊâãÊé®ËΩ¶„ÄÇ", exPy: "chƒÅo sh√¨ l«ê y«íu hƒõn du≈ç sh«íu tuƒ´ chƒì", exEn: "There are many shopping carts in the supermarket." },
        { word: "ÂÆáÂÆôÈ£ûËàπ", pinyin: "y«î zh√≤u fƒìi chu√°n", eng: "Spaceship", emoji: "üõ∏", exZh: "ÂÆáÂÆôÈ£ûËàπÈ£ûÂêëÁÅ´Êòü„ÄÇ", exPy: "y«î zh√≤u fƒìi chu√°n fƒìi xi√†ng hu«í xƒ´ng", exEn: "The spaceship is flying towards Mars." },
        { word: "Âπ≥Ë°°ËΩ¶", pinyin: "p√≠ng h√©ng chƒì", eng: "Hoverboard", emoji: "üõπ", exZh: "Âπ≥Ë°°ËΩ¶ÈùûÂ∏∏ÂèóÂπ¥ËΩª‰∫∫Ê¨¢Ëøé„ÄÇ", exPy: "p√≠ng h√©ng chƒì fƒìi ch√°ng sh√≤u ni√°n qƒ´ng r√©n huƒÅn y√≠ng", exEn: "Hoverboards are very popular among young people." }
    ];

    let currentIdx = 0, currentMode = 'learn', score = 0, rushTimer, timeLeft = 15;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playAudioFeedback(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'correct') {
            osc.frequency.setValueAtTime(523, now); osc.frequency.exponentialRampToValueAtTime(1046, now + 0.1);
            gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(); osc.stop(now + 0.3);
        } else {
            osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(50, now + 0.2);
            gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
            osc.start(); osc.stop(now + 0.2);
        }
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = /[\u4e00-\u9fa5]/.test(text) ? 'zh-CN' : 'en-US';
        window.speechSynthesis.speak(msg);
    }

    function generateRubySentence(zh, py) {
        const chars = zh.split('');
        const pinyins = py.split(' ');
        let html = '';
        let pyIdx = 0;
        chars.forEach((char) => {
            if (/[Ôºå„ÄÇÔºÅÔºü„ÄÅÔºü ]/.test(char)) {
                html += char;
            } else {
                html += `<ruby>${char}<rt>${pinyins[pyIdx] || ''}</rt></ruby>`;
                pyIdx++;
            }
        });
        return html;
    }

    function startMode(m) {
        currentMode = m; score = 0; clearInterval(rushTimer);
        document.querySelectorAll('.mode-view').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.nav-grid button').forEach(b => b.classList.remove('active'));
        if(event) event.target.classList.add('active');

        if(m === 'summary') {
            document.getElementById('summary-container').classList.remove('hidden');
            renderSummary();
        } else if(m === 'quiz' || m === 'timed') {
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-score-tag').innerText = "SCORE: 0";
            if(m === 'timed') {
                timeLeft = 15;
                rushTimer = setInterval(() => {
                    timeLeft -= 0.1;
                    document.getElementById('quiz-timer-tag').innerText = Math.ceil(timeLeft) + "s";
                    if(timeLeft <= 0) { clearInterval(rushTimer); alert("Êó∂Èó¥Âà∞ÔºÅÂæóÂàÜ: " + score); startMode('learn'); }
                }, 100);
            } else { document.getElementById('quiz-timer-tag').innerText = ""; }
            nextQ();
        } else {
            document.getElementById('card-container').classList.remove('hidden');
            renderDisplayCard(true);
        }
    }

    function renderDisplayCard(immediate = false) {
        const h = vocabulary[currentIdx];
        const card = document.getElementById('display-card');
        if(immediate) { updateCardContent(h); return; }
        card.classList.add('is-switching');
        setTimeout(() => { updateCardContent(h); card.classList.remove('is-switching'); }, 200);
    }

    function updateCardContent(h) {
        let frontHTML = '', speakText = h.word;
        if(currentMode === 'learn') {
            frontHTML = `<div class="emoji-huge">${h.emoji}</div><ruby class="word-ruby">${h.word}<rt>${h.pinyin}</rt></ruby>`;
        } else if(currentMode === 'card-cn') {
            frontHTML = `<div class="word-huge" style="margin-top:10vh">${h.word}</div>`;
        } else if(currentMode === 'card-en') {
            frontHTML = `<div class="word-en-huge">${h.eng}</div>`; speakText = h.eng;
        }
        
        document.getElementById('card-f').innerHTML = frontHTML;
        const rubySentence = generateRubySentence(h.exZh, h.exPy);

        document.getElementById('card-b').innerHTML = `
            <div class="emoji-huge" style="font-size:3.5rem; margin-bottom:0;">${h.emoji}</div>
            <ruby class="word-ruby" style="font-size:3rem;">${h.word}<rt>${h.pinyin}</rt></ruby>
            <div class="back-eng-title">${h.eng}</div>
            <div class="ex-container">
                <div class="ex-ruby">${rubySentence}</div>
                <div class="ex-en">${h.exEn}</div>
            </div>`;
            
        document.getElementById('progress-tag').innerText = (currentIdx + 1).toString().padStart(2, '0') + "/" + vocabulary.length;
        speak(speakText);
    }

    function handleCardClick() {
        const card = document.getElementById('display-card');
        if(!card.classList.contains('is-flipped')) {
            card.classList.add('is-flipped'); speak(vocabulary[currentIdx].exZh);
        } else {
            card.classList.remove('is-flipped'); currentIdx = (currentIdx + 1) % vocabulary.length;
            setTimeout(() => { renderDisplayCard(); }, 300); 
        }
    }

    function renderSummary() {
        document.getElementById('summary-list').innerHTML = vocabulary.map(h => `
            <div class="list-item" onclick="speak('${h.word}')">
                <div style="text-align:left"><span style="font-size:1.4rem; font-weight:bold;">${h.emoji} ${h.word}</span></div>
                <div style="color:var(--primary-blue); font-size:1rem; font-weight:600;">${h.eng}</div>
            </div>`).join('');
    }

    function nextQ() {
        const h = vocabulary[Math.floor(Math.random() * vocabulary.length)];
        const isCN = Math.random() > 0.5;
        document.getElementById('quiz-q').innerText = isCN ? h.word : h.eng;
        const correct = isCN ? h.eng : h.word;
        let opts = [correct];
        while(opts.length < 4) {
            let f = vocabulary[Math.floor(Math.random() * vocabulary.length)][isCN ? 'eng' : 'word'];
            if(!opts.includes(f)) opts.push(f);
        }
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('quiz-opts').innerHTML = opts.map(o => `
            <button class="opt-btn" onclick="checkQuizAnswer(this, '${o}', '${correct}')">${o}</button>`).join('');
    }

    function checkQuizAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);
        if(selected === correct) {
            playAudioFeedback('correct'); btn.classList.add('correct');
            score += 10; speak(correct); setTimeout(nextQ, 800);
        } else {
            playAudioFeedback('wrong'); btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
            score = Math.max(0, score - 5); if(currentMode === 'timed') timeLeft -= 1.5;
            setTimeout(nextQ, 1200);
        }
        document.getElementById('quiz-score-tag').innerText = "SCORE: " + score;
    }

    document.querySelector('.nav-grid button').click();
</script>
</body>
</html>