
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, landscape=yes">
    <title>HSK 1 Master - XUSFUNCHINESE</title>
    <style>
        :root {
            --primary: #01579b; 
            --accent: #e1f5fe;  
            --gold: #fbc02d;
            --pinyin: #d0021b; 
            --night-sky: radial-gradient(circle at center, #001f3f 0%, #000510 100%);
        }
        
        body { 
            margin: 0; font-family: "Arial Black", "Segoe UI", Tahoma, sans-serif; 
            background: linear-gradient(135deg, #0277bd 0%, #002f6c 100%); 
            height: 100vh; display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        #cover-page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--night-sky); z-index: 5000; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer; transition: opacity 0.8s ease-out, visibility 0.8s; overflow: hidden;
        }

        .star {
            position: absolute; top: 50%; left: 50%; width: 2px; height: 2px;
            background: white; border-radius: 50%; box-shadow: 0 0 10px #fff;
            animation: shoot linear infinite;
        }

        @keyframes shoot {
            0% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(1000px); opacity: 0; width: 160px; }
        }

        .cover-content { text-align: center; z-index: 10; padding: 20px; }
        .cover-title { font-size: 7.5vw; color: white; line-height: 1.2; text-transform: uppercase; margin: 0; }
        .cover-subtitle { font-size: 10vw; color: var(--gold); margin-top: 5px; font-weight: 900; animation: pulse 2s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        header { 
            background: rgba(255,255,255,0.95); padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 100; 
        }
        .nav-container { display: flex; align-items: center; flex: 1; }
        .nav-btns button { 
            padding: 8px 12px; margin-right: 5px; border-radius: 20px; border: 2px solid var(--primary); 
            cursor: pointer; font-weight: bold; background: white; color: var(--primary);
        }
        .active-mode { background: var(--primary) !important; color: white !important; }

        .header-watermark {
            margin-left: 15px; font-size: 22px; font-weight: 900;
            color: rgba(1, 87, 155, 0.4); letter-spacing: 2px; pointer-events: none;
        }

        main { flex: 1; display: flex; padding: 20px; gap: 15px; overflow: hidden; }
        #left-panel { flex: 1; background: rgba(255,255,255,0.95); border-radius: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid var(--accent); }
        #right-panel { flex: 1.6; background: rgba(255,255,255,0.95); border-radius: 30px; padding: 30px; display: flex; flex-direction: column; overflow-y: auto; border: 4px solid var(--accent); position: relative; }

        ruby { ruby-align: center; font-size: 50px; margin: 0 4px; line-height: 2.2; font-weight: 600; }
        rt { font-size: 20px; color: var(--pinyin); font-weight: bold; }
        .eng-hint { display: block; font-size: 26px; color: #333; margin-top: 15px; border-top: 2px dashed #ccc; padding-top: 10px; font-style: italic; }
        #emoji-display { font-size: 130px; margin-bottom: 20px; }
        
        .option-btn { background: white; border: 2px solid var(--primary); padding: 15px; margin: 8px 0; border-radius: 15px; cursor: pointer; font-size: 20px; width: 100%; transition: 0.2s; }
        
        #scroll-view { display: none; width: 100%; overflow-y: auto; padding: 30px; background: white; border-radius: 30px; }
        .list-row { border-bottom: 1px solid var(--accent); padding: 15px; cursor: pointer; display: flex; align-items: center; }
        .hidden { display: none !important; }
        #timer-display { font-size: 24px; color: #d32f2f; font-weight: bold; margin-right: 15px; }
        
        #result-screen { text-align: center; padding: 30px; width: 100%; }
        .result-score { font-size: 100px; color: var(--gold); margin: 10px 0; text-shadow: 2px 4px 10px rgba(0,0,0,0.1); }
        .subscribe-msg { font-size: 26px; color: var(--primary); font-weight: 900; margin-bottom: 40px; }
    </style>
</head>
<body>

<div id="cover-page" onclick="enterApp()">
    <div id="star-container"></div>
    <div class="cover-content">
        <h1 class="cover-title">50 MOST USEFUL<br>WORDS (1)</h1>
        <div class="cover-subtitle">HSK 1</div>
        <div class="click-hint">CLICK TO START</div>
    </div>
</div>

<header>
    <div class="nav-container">
        <div class="nav-btns">
            <button onclick="setMode('study')" id="btn-study">ğŸ“– Learn</button>
            <button onclick="setMode('review')" id="btn-review">ğŸ”„ Review</button>
            <button onclick="setMode('quiz')" id="btn-quiz">âš¡ Quiz</button>
            <button onclick="setMode('rush')" id="btn-rush">ğŸ”¥ Rush (30s)</button>
            <button onclick="setMode('mistakes')" id="btn-mistakes">âŒ Mistakes</button>
        </div>
        <div class="header-watermark">XUSFUNCHINESE</div>
    </div>
    <div id="status-bar" style="display: flex; align-items: center;">
        <span id="timer-display" class="hidden">00:30</span>
        <button onclick="setMode('list')" id="btn-list" style="padding: 8px 12px; border-radius: 20px; border: 2px solid var(--primary); cursor: pointer; font-weight: bold; background: white; color: var(--primary);">ğŸ“œ List</button>
        <span style="font-weight: bold; color: var(--primary); margin-left:15px;">Score: <span id="score-val">0</span></span>
    </div>
</header>

<main>
    <div id="main-ui" style="display: flex; width: 100%; gap: 15px;">
        <div id="left-panel">
            <div id="emoji-display">ğŸ‘‹</div>
            <button onclick="speakItem(true)" style="padding: 15px 40px; border-radius: 50px; cursor: pointer; background: var(--primary); color: white; border: none; font-weight: bold; font-size: 20px;">ğŸ”Š Play Sound</button>
        </div>
        <div id="right-panel">
            <div id="display-area"></div>
            <div id="hint-box" style="margin-top:20px; padding:15px; background:#fffde7; border-left:8px solid var(--gold); border-radius:12px;" class="hidden"></div>
            <div id="interaction-area" style="margin-top: 15px;"></div>
        </div>
    </div>
    <div id="scroll-view"></div>
</main>

<script>
    const database = [
        ["æˆ‘", "wÇ’", "I / me", "ğŸ™‹â€â™‚ï¸", {cn: "æˆ‘æ˜¯è€å¸ˆã€‚", py: "wÇ’ shÃ¬ lÇo shÄ«", en: "I am a teacher."}],
        ["ä½ ", "nÇ", "you", "ğŸ‘¤", {cn: "ä½ å¥½ï¼", py: "nÇ hÇo", en: "Hello!"}],
        ["ä»–", "tÄ", "he", "ğŸ‘¨", {cn: "ä»–æ˜¯å­¦ç”Ÿã€‚", py: "tÄ shÃ¬ xuÃ© sheng", en: "He is a student."}],
        ["å¥¹", "tÄ", "she", "ğŸ‘©", {cn: "å¥¹æ˜¯æˆ‘çš„æœ‹å‹ã€‚", py: "tÄ shÃ¬ wÇ’ de pÃ©ng you", en: "She is my friend."}],
        ["æˆ‘ä»¬", "wÇ’ men", "we", "ğŸ‘¥", {cn: "æˆ‘ä»¬å»å­¦æ ¡ã€‚", py: "wÇ’ men qÃ¹ xuÃ© xiÃ o", en: "We go to school."}],
        ["å¥½", "hÇo", "good", "ğŸ‘", {cn: "å¾ˆå¥½ã€‚", py: "hÄ›n hÇo", en: "Very good."}],
        ["æ˜¯", "shÃ¬", "to be", "âœ…", {cn: "ä½ æ˜¯è°ï¼Ÿ", py: "nÇ shÃ¬ shÃ©i", en: "Who are you?"}],
        ["ä¸", "bÃ¹", "not", "âŒ", {cn: "æˆ‘ä¸å»ã€‚", py: "wÇ’ bÃº qÃ¹", en: "I'm not going."}],
        ["è°¢è°¢", "xiÃ¨ xie", "thanks", "ğŸ™", {cn: "è°¢è°¢ä½ ã€‚", py: "xiÃ¨ xie nÇ", en: "Thank you."}],
        ["å†è§", "zÃ i jiÃ n", "goodbye", "ğŸ‘‹", {cn: "å†è§ï¼", py: "zÃ i jiÃ n", en: "Goodbye!"}],
        ["è¯·", "qÇng", "please", "ğŸ™‡", {cn: "è¯·åã€‚", py: "qÇng zuÃ²", en: "Please sit down."}],
        ["å¯¹ä¸èµ·", "duÃ¬ bu qÇ", "sorry", "ğŸ™‡â€â™‚ï¸", {cn: "å¯¹ä¸èµ·ã€‚", py: "duÃ¬ bu qÇ", en: "I am sorry."}],
        ["è€å¸ˆ", "lÇo shÄ«", "teacher", "ğŸ‘¨â€ğŸ«", {cn: "è€å¸ˆå¥½ï¼", py: "lÇo shÄ« hÇo", en: "Hello teacher!"}],
        ["å­¦ç”Ÿ", "xuÃ© sheng", "student", "ğŸ§‘â€ğŸ“", {cn: "ä»–æ˜¯å­¦ç”Ÿã€‚", py: "tÄ shÃ¬ xuÃ© sheng", en: "He is a student."}],
        ["æœ‹å‹", "pÃ©ng you", "friend", "ğŸ‘«", {cn: "æˆ‘çš„æœ‹å‹ã€‚", py: "wÇ’ de pÃ©ng you", en: "My friend."}],
        ["åŒ»ç”Ÿ", "yÄ« shÄ“ng", "doctor", "ğŸ‘¨â€âš•ï¸", {cn: "ä»–æ˜¯åŒ»ç”Ÿã€‚", py: "tÄ shÃ¬ yÄ« shÄ“ng", en: "He is a doctor."}],
        ["å®¶", "jiÄ", "home", "ğŸ ", {cn: "æˆ‘å›å®¶ã€‚", py: "wÇ’ huÃ­ jiÄ", en: "I go home."}],
        ["å­¦æ ¡", "xuÃ© xiÃ o", "school", "ğŸ«", {cn: "æˆ‘å»å­¦æ ¡ã€‚", py: "wÇ’ qÃ¹ xuÃ© xiÃ o", en: "I go to school."}],
        ["å•†åº—", "shÄng diÃ n", "shop", "ğŸ›’", {cn: "å•†åº—åœ¨é‚£å„¿ã€‚", py: "shÄng diÃ n zÃ i nÃ  r", en: "The shop is there."}],
        ["ç°åœ¨", "xiÃ n zÃ i", "now", "â°", {cn: "ç°åœ¨å‡ ç‚¹ï¼Ÿ", py: "xiÃ n zÃ i jÇ diÇn", en: "What time is it now?"}],
        ["ä»Šå¤©", "jÄ«n tiÄn", "today", "ğŸ“…", {cn: "ä»Šå¤©æ˜ŸæœŸä¸€ã€‚", py: "jÄ«n tiÄn xÄ«ng qÄ« yÄ«", en: "Today is Monday."}],
        ["æ˜¨å¤©", "zuÃ³ tiÄn", "yesterday", "âª", {cn: "æ˜¨å¤©æ˜¯å‡ å·ï¼Ÿ", py: "zuÃ³ tiÄn shÃ¬ jÇ hÃ o", en: "What date was yesterday?"}],
        ["æ˜å¤©", "mÃ­ng tiÄn", "tomorrow", "â©", {cn: "æ˜å¤©è§ã€‚", py: "mÃ­ng tiÄn jiÃ n", en: "See you tomorrow."}],
        ["å¹´", "niÃ¡n", "year", "ğŸ—“ï¸", {cn: "ä»Šå¹´æ˜¯å“ªå¹´ï¼Ÿ", py: "jÄ«n niÃ¡n shÃ¬ nÇ niÃ¡n", en: "What year is this year?"}],
        ["æœˆ", "yuÃ¨", "month", "ğŸŒ™", {cn: "ä¸€æœˆä¸€å·ã€‚", py: "yÄ« yuÃ¨ yÄ« hÃ o", en: "January 1st."}],
        ["å·", "hÃ o", "date", "ğŸ”¢", {cn: "ä»Šå¤©ä¸‰å·ã€‚", py: "jÄ«n tiÄn sÄn hÃ o", en: "Today is the 3rd."}],
        ["ç‚¹", "diÇn", "o'clock", "ğŸ•’", {cn: "ä¸‹åˆä¸‰ç‚¹ã€‚", py: "xiÃ  wÇ” sÄn diÇn", en: "3 PM."}],
        ["åˆ†é’Ÿ", "fÄ“n zhÅng", "minute", "â±ï¸", {cn: "äº”åˆ†é’Ÿã€‚", py: "wÇ” fÄ“n zhÅng", en: "Five minutes."}],
        ["é’±", "qiÃ¡n", "money", "ğŸ’°", {cn: "å¤šå°‘é’±ï¼Ÿ", py: "duÅ shao qiÃ¡n", en: "How much money?"}],
        ["æ°´", "shuÇ", "water", "ğŸ’§", {cn: "å–æ°´ã€‚", py: "hÄ“ shuÇ", en: "Drink water."}],
        ["èŒ¶", "chÃ¡", "tea", "ğŸµ", {cn: "æˆ‘æƒ³å–èŒ¶ã€‚", py: "wÇ’ xiÇng hÄ“ chÃ¡", en: "I want to drink tea."}],
        ["æ°´æœ", "shuÇ guÇ’", "fruit", "ğŸ", {cn: "åƒæ°´æœã€‚", py: "chÄ« shuÇ guÇ’", en: "Eat fruit."}],
        ["è‹¹æœ", "pÃ­ng guÇ’", "apple", "ğŸ", {cn: "ä¹°è‹¹æœã€‚", py: "mÇi pÃ­ng guÇ’", en: "Buy apples."}],
        ["æ¯å­", "bÄ“i zi", "cup", "ğŸ¥›", {cn: "è¿™æ˜¯æˆ‘çš„æ¯å­ã€‚", py: "zhÃ¨ shÃ¬ wÇ’ de bÄ“i zi", en: "This is my cup."}],
        ["ä¹¦", "shÅ«", "book", "ğŸ“–", {cn: "çœ‹ä¹¦ã€‚", py: "kÃ n shÅ«", en: "Read a book."}],
        ["æ¤…å­", "yÇ zi", "chair", "ğŸª‘", {cn: "æ¡Œå­å’Œæ¤…å­ã€‚", py: "zhuÅ zi hÃ© yÇ zi", en: "Table and chair."}],
        ["æ¡Œå­", "zhuÅ zi", "table", "ğŸ±", {cn: "æ¡Œå­ä¸Šæœ‰ä¹¦ã€‚", py: "zhuÅ zi shang yÇ’u shÅ«", en: "There's a book on the table."}],
        ["çŒ«", "mÄo", "cat", "ğŸ±", {cn: "å°çŒ«ã€‚", py: "xiÇo mÄo", en: "Little cat."}],
        ["ç‹—", "gÇ’u", "dog", "ğŸ¶", {cn: "ä¸€åªå°ç‹—ã€‚", py: "yÃ¬ zhÄ« xiÇo gÇ’u", en: "A little dog."}],
        ["åŒ—äº¬", "bÄ›i jÄ«ng", "Beijing", "ğŸ™ï¸", {cn: "ä»–åœ¨åŒ—äº¬ã€‚", py: "tÄ zÃ i bÄ›i jÄ«ng", en: "He is in Beijing."}],
        ["çœ‹", "kÃ n", "look", "ğŸ‘ï¸", {cn: "çœ‹ç”µè§†ã€‚", py: "kÃ n diÃ n shÃ¬", en: "Watch TV."}],
        ["å¬", "tÄ«ng", "listen", "ğŸ‘‚", {cn: "å¬éŸ³ä¹ã€‚", py: "tÄ«ng yÄ«n yuÃ¨", en: "Listen to music."}],
        ["è¯´è¯", "shuÅ huÃ ", "speak", "ğŸ’¬", {cn: "ä»–åœ¨è¯´è¯ã€‚", py: "tÄ zÃ i shuÅ huÃ ", en: "He is speaking."}],
        ["è¯»", "dÃº", "read", "ğŸ“š", {cn: "è¯»æ±‰è¯­ã€‚", py: "dÃº hÃ n yÇ”", en: "Read Chinese."}],
        ["å†™", "xiÄ›", "write", "âœï¸", {cn: "å†™æ±‰å­—ã€‚", py: "xiÄ› hÃ n zÃ¬", en: "Write Chinese characters."}],
        ["å–", "hÄ“", "drink", "ğŸ¹", {cn: "å–ç‚¹å„¿æ°´ã€‚", py: "hÄ“ diÇnr shuÇ", en: "Drink some water."}],
        ["åƒ", "chÄ«", "eat", "ğŸ±", {cn: "åƒç±³é¥­ã€‚", py: "chÄ« mÇ fÃ n", en: "Eat rice."}],
        ["å¼€", "kÄi", "drive / open", "ğŸš—", {cn: "å¼€è½¦ã€‚", py: "kÄi chÄ“", en: "Drive a car."}],
        ["å", "zuÃ²", "sit", "ğŸ§", {cn: "åè½¦ã€‚", py: "zuÃ² chÄ“", en: "Take a bus/car."}],
        ["ä¹°", "mÇi", "buy", "ğŸ›ï¸", {cn: "ä¹°è¡£æœã€‚", py: "mÇi yÄ« fu", en: "Buy clothes."}]
    ];

    let currentMode = 'study', currentIndex = 0, score = 0, timer = null;
    let mistakes = [];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playEffect(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'coin') {
            osc.frequency.setValueAtTime(987, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1318, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        } else if(type === 'disappoint') {
            osc.type = 'sawtooth'; osc.frequency.setValueAtTime(220, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(110, audioCtx.currentTime + 0.3);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.start(); osc.stop(audioCtx.currentTime + 0.3);
        }
    }

    function initStars() {
        const container = document.getElementById('star-container');
        for(let i=0; i<80; i++) {
            let s = document.createElement('div'); s.className = 'star';
            s.style.setProperty('--angle', Math.random() * 360 + 'deg');
            s.style.animationDuration = Math.random() * 1.5 + 0.8 + 's';
            container.appendChild(s);
        }
    }

    function enterApp() {
        document.getElementById('cover-page').style.opacity = '0';
        setTimeout(() => { document.getElementById('cover-page').style.visibility = 'hidden'; }, 800);
        setMode('study');
    }

    function speakText(text, callback = null) {
        window.speechSynthesis.cancel();
        const m = new SpeechSynthesisUtterance(text);
        m.lang = 'zh-CN'; m.rate = 0.85;
        if (callback) m.onend = callback;
        window.speechSynthesis.speak(m);
    }

    function speakItem(withExample = false) {
        const item = database[currentIndex];
        if (!item) return;
        // å­¦ä¹ æ¨¡å¼ä¸‹ï¼Œå¦‚æœæ˜¯æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾ï¼Œåˆ™æ’­æ”¾å•è¯+ä¾‹å¥ï¼›å¦‚æœæ˜¯renderè§¦å‘ï¼Œåˆ™åªæ’­æ”¾å•è¯
        if (withExample) speakText(item[0], () => setTimeout(() => speakText(item[4].cn), 400));
        else speakText(item[0]);
    }

    function setMode(m) {
        currentMode = m; currentIndex = 0; clearInterval(timer); score = 0;
        document.getElementById('score-val').innerText = "0";
        document.querySelectorAll('.nav-btns button, #btn-list').forEach(b => b.classList.remove('active-mode'));
        if(document.getElementById('btn-'+m)) document.getElementById('btn-'+m).classList.add('active-mode');
        document.getElementById('timer-display').classList.add('hidden');
        
        document.getElementById('right-panel').innerHTML = `
            <div id="display-area"></div>
            <div id="hint-box" style="margin-top:20px; padding:15px; background:#fffde7; border-left:8px solid var(--gold); border-radius:12px;" class="hidden"></div>
            <div id="interaction-area" style="margin-top: 15px;"></div>
        `;

        if(m === 'list') {
            document.getElementById('main-ui').classList.add('hidden');
            document.getElementById('scroll-view').style.display = 'block';
            renderList();
        } else {
            document.getElementById('main-ui').classList.remove('hidden');
            document.getElementById('scroll-view').style.display = 'none';
            if (m === 'rush') startRush();
            render();
        }
    }

    function startRush() {
        let timeLeft = 30; score = 0;
        const display = document.getElementById('timer-display');
        display.classList.remove('hidden');
        timer = setInterval(() => {
            timeLeft--;
            display.innerText = `00:${timeLeft < 10 ? '0'+timeLeft : timeLeft}`;
            if (timeLeft <= 0) {
                clearInterval(timer);
                showFinalResult();
            }
        }, 1000);
    }

    function showFinalResult() {
        const praises = ["å¤ªæ£’äº†ï¼", "ä½ çœŸäº†ä¸èµ·ï¼", "å¹²å¾—æ¼‚äº®ï¼", "å®Œç¾çš„ä¸€è½®ï¼"];
        speakText(praises[Math.floor(Math.random()*praises.length)]);
        
        const rightPanel = document.getElementById('right-panel');
        rightPanel.innerHTML = `
            <div id="result-screen">
                <div class="result-score">${score}</div>
                <div class="subscribe-msg">Subscribe to â€œXu's Fun Chineseâ€ for more!</div>
                <button class="option-btn" onclick="setMode('study')" style="background:var(--primary); color:white; width:220px; margin: 0 auto;">Back to Learn</button>
            </div>
        `;
    }

    function generateRubyHtml(text, pinyinStr) {
        const chars = text.split(''); const pys = pinyinStr.split(' ');
        let html = ""; let pyIdx = 0;
        chars.forEach(c => {
            if(/[\u4e00-\u9fa5]/.test(c)) {
                html += `<ruby>${c}<rt>${pys[pyIdx] || ''}</rt></ruby>`; pyIdx++;
            } else html += c;
        });
        return html;
    }

    function render() {
        const display = document.getElementById('display-area');
        const interaction = document.getElementById('interaction-area');
        const hint = document.getElementById('hint-box');
        if (!display) return;

        let activeList = (currentMode === 'mistakes') ? mistakes : database;
        if (activeList.length === 0 && currentMode === 'mistakes') {
            display.innerHTML = "<h2>é”™é¢˜æœ¬ä¸ºç©ºã€‚</h2>";
            interaction.innerHTML = `<button class="option-btn" onclick="setMode('study')">è¿”å›å­¦ä¹ </button>`;
            return;
        }

        const item = activeList[currentIndex];
        document.getElementById('emoji-display').innerText = item[3];
        interaction.innerHTML = ""; hint.classList.add('hidden');

        if(currentMode === 'study' || currentMode === 'review') {
            display.innerHTML = generateRubyHtml(item[0], item[1]) + `<span class="eng-hint">${item[2]}</span>`;
            hint.innerHTML = `<div style="font-size:26px; padding:5px; cursor:pointer;" onclick="speakText('${item[4].cn}')">${generateRubyHtml(item[4].cn, item[4].py)}</div><div style="font-style:italic; color:#666; margin-top:8px;">${item[4].en}</div>`;
            
            if(currentMode === 'study') {
                hint.classList.remove('hidden');
                speakItem(false); // å­¦ä¹ æ¨¡å¼åªè‡ªåŠ¨æ’­æ”¾å•è¯ï¼Œä¸è‡ªåŠ¨æ’­æ”¾ä¾‹å¥
            } else {
                speakItem(false);
                interaction.innerHTML = `<button class="option-btn" onclick="document.getElementById('hint-box').classList.toggle('hidden')">ğŸ‘ï¸ æ˜¾ç¤º/éšè—ä¾‹å¥</button>`;
            }
            interaction.innerHTML += `<button class="option-btn" onclick="nextCard()" style="background:var(--primary); color:white;">ä¸‹ä¸€å¼  â†’</button>`;
        } else {
            const isSentence = currentIndex % 2 === 1;
            const isEnToCn = Math.random() > 0.5;
            
            let questText, correctAns, speakTarget;
            if (isSentence) {
                questText = isEnToCn ? item[4].en : item[4].cn;
                correctAns = isEnToCn ? item[4].cn : item[4].en;
                speakTarget = item[4].cn;
            } else {
                questText = isEnToCn ? item[2] : item[0];
                correctAns = isEnToCn ? item[0] : item[2];
                speakTarget = item[0];
            }

            display.innerHTML = `<h2 style="font-size:40px; text-align:center; color:var(--primary);">${questText}</h2>`;
            
            let choices = [correctAns];
            while(choices.length < 4) {
                let r = database[Math.floor(Math.random()*database.length)];
                let val;
                if (isSentence) val = isEnToCn ? r[4].cn : r[4].en;
                else val = isEnToCn ? r[0] : r[2];
                if(!choices.includes(val)) choices.push(val);
            }
            choices.sort(() => Math.random() - 0.5);

            choices.forEach(c => {
                const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = c;
                b.onclick = () => {
                    if(c === correctAns) {
                        playEffect('coin');
                        speakText(speakTarget);
                        score += 10; document.getElementById('score-val').innerText = score;
                        b.style.background = "#4caf50"; b.style.color = "white"; 
                        setTimeout(nextCard, 800);
                    } else { 
                        playEffect('disappoint');
                        b.style.background = "#f44336"; b.style.color = "white";
                        if (!mistakes.includes(item)) mistakes.push(item);
                    }
                };
                interaction.appendChild(b);
            });
        }
    }

    function nextCard() {
        let activeList = (currentMode === 'mistakes') ? mistakes : database;
        if (currentIndex >= activeList.length - 1) {
            if (currentMode === 'quiz') showFinalResult();
            else { currentIndex = 0; render(); }
        } else {
            currentIndex++;
            render();
        }
    }

    function renderList() {
        const view = document.getElementById('scroll-view');
        view.innerHTML = "<h2>ğŸ“œ HSK 1 Vocabulary List</h2>";
        database.forEach((it, idx) => {
            const r = document.createElement('div'); r.className = 'list-row';
            r.innerHTML = `<div style="font-size: 20px; min-width: 40px; color: #888;">${idx+1}</div>
                <div style="font-size: 32px; margin-right: 15px;">${it[3]}</div>
                <div style="flex: 1;"><span style="font-size:24px; font-weight:bold;">${it[0]}</span> 
                <span style="color:var(--pinyin); font-weight:bold; margin-left:10px;">[ ${it[1]} ]</span> 
                <div style="color:#555; font-size: 18px;">${it[2]}</div></div>`;
            r.onclick = () => speakText(it[0]);
            view.appendChild(r);
        });
    }

    window.onload = () => initStars();
</script>
</body>
</html>