<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>38 Hobbies - Ruby Edition</title>
    <style>
        :root {
            --primary-blue: #2980b9;
            --dark-gray: #2c3e50;
            --accent-orange: #f39c12;
            --bg-light: #ffffff;
            --text-black: #1a1a1a;
            --correct-green: #2ecc71;
            --wrong-red: #e74c3c;
            --pinyin-gray: #999;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif, 'Microsoft YaHei';
            background-color: var(--bg-light);
            margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 100vw; height: 100vh; max-width: 600px; background: white; 
            padding: 1rem; box-sizing: border-box; display: flex; flex-direction: column;
        }

        .nav-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; 
            margin-bottom: 10px; flex-shrink: 0; z-index: 100;
        }
        .nav-grid button { 
            font-size: 0.75rem; padding: 10px 2px; background: #f5f5f5; 
            border-radius: 8px; border: none; color: #666; cursor: pointer; font-weight: bold; 
        }
        .nav-grid button.active { background: var(--dark-gray); color: white; }

        .card-scene { flex-grow: 1; perspective: 1000px; position: relative; }
        .card { width: 100%; height: 100%; position: relative; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s; transform-style: preserve-3d; cursor: pointer; }
        .card.is-flipped { transform: rotateY(180deg); }
        .card.is-switching { opacity: 0; }
        
        .card-face { 
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
            display: flex; flex-direction: column; align-items: center; 
            background: white; text-align: center;
            padding: 18vh 20px 20px 20px;
            box-sizing: border-box;
        }
        
        .card-back { transform: rotateY(180deg); background: #fafafa; border-radius: 24px; padding-top: 10vh; }

        .emoji-huge { font-size: 7.5rem; margin-bottom: 10px; }
        .word-huge { font-size: 6rem; font-weight: 900; color: var(--text-black); line-height: 1; }
        .word-en-huge { font-size: 4rem; font-weight: 800; color: var(--primary-blue); line-height: 1.1; margin-top: 5vh; }
        
        /* Ê†∏ÂøÉÂØπÈΩêÊ†∑Âºè */
        .word-ruby { font-size: 4rem; font-weight: 900; color: var(--text-black); margin: 0; line-height: 1.2;}
        .ex-ruby { font-size: 1.6rem; font-weight: bold; color: var(--text-black); line-height: 2.2; margin-bottom: 15px; }
        rt { font-size: 0.9rem; color: var(--pinyin-gray); font-weight: normal; transform: translateY(-2px); }
        
        .back-eng-title { font-size: 2.2rem; font-weight: bold; color: var(--accent-orange); margin: 10px 0 30px 0; }
        .ex-container { width: 100%; padding-top: 25px; border-top: 1px solid #eee; margin-top: auto; padding-bottom: 5vh;}
        .ex-en { font-size: 1.2rem; color: #777; font-style: italic; line-height: 1.2; padding: 0 10px; }

        #progress-tag { position: absolute; top: -5px; left: 0; font-size: 0.85rem; color: #eee; font-weight: bold; }

        .opt-btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #eee; background: white; border-radius: 12px; font-size: 1.3rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .opt-btn.correct { background-color: var(--correct-green) !important; color: white; border-color: var(--correct-green); }
        .opt-btn.wrong { background-color: var(--wrong-red) !important; color: white; border-color: var(--wrong-red); animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }

        #summary-container { flex-grow: 1; overflow-y: auto; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 18px; border-bottom: 1px solid #f9f9f9; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="app">
    <div class="nav-grid" id="nav-btns">
        <button onclick="startMode('learn')">LEARN</button>
        <button onclick="startMode('card-cn')">CARD(CN)</button>
        <button onclick="startMode('card-en')">CARD(EN)</button>
        <button onclick="startMode('quiz')">QUIZ</button>
        <button onclick="startMode('timed')">RUSH</button>
        <button onclick="startMode('summary')">LIST</button>
    </div>

    <div id="card-container" class="mode-view">
        <div id="progress-tag">01/38</div>
        <div class="card-scene">
            <div class="card" id="display-card" onclick="handleCardClick()">
                <div class="card-face card-front" id="card-f"></div>
                <div class="card-face card-back" id="card-b"></div>
            </div>
        </div>
    </div>

    <div id="summary-container" class="mode-view hidden"><div id="summary-list"></div></div>

    <div id="quiz-container" class="mode-view hidden" style="flex-grow:1; padding:20px; text-align:center;">
        <div style="display:flex; justify-content:space-between; font-weight:bold; color:#ddd; margin-bottom:10px;">
            <span id="quiz-score-tag">SCORE: 0</span>
            <span id="quiz-timer-tag"></span>
        </div>
        <div id="quiz-q" style="font-size:2.8rem; font-weight:bold; margin: 30px 0; color:var(--primary-blue);"></div>
        <div id="quiz-opts"></div>
    </div>
</div>

<script>
    const hobbies = [
        { word: "Âà∑Ââß", pinyin: "shuƒÅ j√π", eng: "Binge-watching", emoji: "üì∫", exZh: "ÊàëÊï¥‰∏™Âë®Êú´ÈÉΩÂú®ÂÆ∂ÈáåÂà∑Ââß„ÄÇ", exPy: "w«í zhƒõng g√® zh≈çu m√≤ d≈çu z√†i jiƒÅ l«ê shuƒÅ j√π", exEn: "I spent the whole weekend binge-watching." },
        { word: "ÊëÑÂΩ±", pinyin: "sh√® y«êng", eng: "Photography", emoji: "üì∑", exZh: "‰ªñÈùûÂ∏∏ÂñúÊ¨¢ÂéªÂÖ¨Âõ≠ÊëÑÂΩ±„ÄÇ", exPy: "tƒÅ fƒìi ch√°ng x«ê huƒÅn q√π g≈çng yu√°n sh√® y«êng", exEn: "He really likes going to the park for photography." },
        { word: "ÁÉπÈ•™", pinyin: "pƒìng r√®n", eng: "Cooking", emoji: "üç≥", exZh: "ÁÉπÈ•™ÊòØ‰∏ÄÁßçÂæàÂ•ΩÁöÑÊîæÊùæÊñπÂºè„ÄÇ", exPy: "pƒìng r√®n sh√¨ y√¨ zh«íng hƒõn h«éo de f√†ng s≈çng fƒÅng sh√¨", exEn: "Cooking is a great way to relax." },
        { word: "Âõ≠Ëâ∫", pinyin: "yu√°n y√¨", eng: "Gardening", emoji: "ü™¥", exZh: "Â•∂Â•∂Âú®Èò≥Âè∞‰∏äÁªÉ‰π†Âõ≠Ëâ∫„ÄÇ", exPy: "n«éi nai z√†i y√°ng t√°i sh√†ng li√†n x√≠ yu√°n y√¨", exEn: "Grandma is practicing gardening on the balcony." },
        { word: "ÈòÖËØª", pinyin: "yu√® d√∫", eng: "Reading", emoji: "üìñ", exZh: "ÈòÖËØªËÉΩÂºÄÈòîÊàë‰ª¨ÁöÑËßÜÈáé„ÄÇ", exPy: "yu√® d√∫ n√©ng kƒÅi ku√≤ w«í men de sh√¨ yƒõ", exEn: "Reading can broaden our horizons." },
        { word: "ÁªòÁîª", pinyin: "hu√¨ hu√†", eng: "Painting", emoji: "üé®", exZh: "Â•πÊ≠£Âú®ÁªôÁ™óÂ§ñÁöÑÈ£éÊôØÁªòÁîª„ÄÇ", exPy: "tƒÅ zh√®ng z√†i gƒõi chuƒÅng w√†i de fƒìng j«êng hu√¨ hu√†", exEn: "She is painting the scenery outside the window." },
        { word: "ÂÜ•ÊÉ≥", pinyin: "m√≠ng xi«éng", eng: "Meditation", emoji: "üßò", exZh: "ÊØèÂ§©ÂÜ•ÊÉ≥ÂçÅÂàÜÈíüÂæàÊúâÂ•ΩÂ§Ñ„ÄÇ", exPy: "mƒõi tiƒÅn m√≠ng xi«éng sh√≠ fƒìn zh≈çng hƒõn y«íu h«éo ch√π", exEn: "Meditating for ten minutes every day is beneficial." },
        { word: "ÊâãÂ∑•", pinyin: "sh«íu g≈çng", eng: "Crafting", emoji: "üß∂", exZh: "ÊàëÂñúÊ¨¢Âú®ËØæ‰ΩôÊó∂Èó¥ÂÅöÊâãÂ∑•„ÄÇ", exPy: "w«í x«ê huƒÅn z√†i k√® y√∫ sh√≠ jiƒÅn zu√≤ sh«íu g≈çng", exEn: "I like to do crafting in my spare time." },
        { word: "Ê°åÊ∏∏", pinyin: "zhu≈ç y√≥u", eng: "Board Gaming", emoji: "üé≤", exZh: "Êàë‰ª¨ÁªèÂ∏∏ËÅöÂú®‰∏ÄËµ∑Áé©Ê°åÊ∏∏„ÄÇ", exPy: "w«í men jƒ´ng ch√°ng j√π z√†i y√¨ q«ê w√°n zhu≈ç y√≥u", exEn: "We often get together to play board games." },
        { word: "ÊâãË¥¶", pinyin: "sh«íu zh√†ng", eng: "Journaling", emoji: "üìì", exZh: "ÂÅöÊâãË¥¶ËÉΩÂ∏ÆÊàëÊï¥ÁêÜÁîüÊ¥ª„ÄÇ", exPy: "zu√≤ sh«íu zh√†ng n√©ng bƒÅng w«í zhƒõng l«ê shƒìng hu√≥", exEn: "Journaling helps me organize my life." },
        { word: "Âê¨Êí≠ÂÆ¢", pinyin: "tƒ´ng b≈ç k√®", eng: "Listening to Podcasts", emoji: "üéß", exZh: "ÊàëÂñúÊ¨¢Âú®ÂºÄËΩ¶Êó∂Âê¨Êí≠ÂÆ¢„ÄÇ", exPy: "w«í x«ê huƒÅn z√†i kƒÅi chƒì sh√≠ tƒ´ng b≈ç k√®", exEn: "I like listening to podcasts while driving." },
        { word: "ËßÇÊòü", pinyin: "guƒÅn xƒ´ng", eng: "Stargazing", emoji: "üî≠", exZh: "ÈÉäÂ§ñÁöÑÂ§úÊôöÈùûÂ∏∏ÈÄÇÂêàËßÇÊòü„ÄÇ", exPy: "jiƒÅo w√†i de y√® w«én fƒìi ch√°ng sh√¨ h√© guƒÅn xƒ´ng", exEn: "The night in the suburbs is perfect for stargazing." },
        { word: "ÊãºÂõæ", pinyin: "pƒ´n t√∫", eng: "Jigsaw Puzzles", emoji: "üß©", exZh: "Ëøô‰∏™ÊãºÂõæËä±‰∫ÜÊàë‰∏âÂ§©Êó∂Èó¥„ÄÇ", exPy: "zh√® g√® pƒ´n t√∫ huƒÅ le w«í sƒÅn tiƒÅn sh√≠ jiƒÅn", exEn: "This puzzle took me three days to finish." },
        { word: "ÁÉòÁÑô", pinyin: "h≈çng b√®i", eng: "Baking", emoji: "üßÅ", exZh: "Â±ãÂ≠êÈáåÂÖÖÊª°‰∫ÜÁÉòÁÑôÁöÑÈ¶ôÂë≥„ÄÇ", exPy: "w≈´ zi l«ê ch≈çng m«én le h≈çng b√®i de xiƒÅng w√®i", exEn: "The house is full of the smell of baking." },
        { word: "ÈõÜÈÇÆ", pinyin: "j√≠ y√≥u", eng: "Stamp Collecting", emoji: "üè∑Ô∏è", exZh: "ÈõÜÈÇÆÊòØ‰ªñÂ§öÂπ¥ÁöÑÁà±Â•Ω„ÄÇ", exPy: "j√≠ y√≥u sh√¨ tƒÅ du≈ç ni√°n de √†i h√†o", exEn: "Stamp collecting is his hobby of many years." },
        { word: "‰πêÈ´ò", pinyin: "l√® gƒÅo", eng: "Building LEGO", emoji: "üß±", exZh: "Êãº‰πêÈ´òÈúÄË¶ÅÂæàÂ§ßÁöÑËÄêÂøÉ„ÄÇ", exPy: "pƒ´n l√® gƒÅo x≈´ y√†o hƒõn d√† de n√†i xƒ´n", exEn: "Building LEGO requires a lot of patience." },
        { word: "ÈíìÈ±º", pinyin: "di√†o y√∫", eng: "Fishing", emoji: "üé£", exZh: "Áà∏Áà∏ÊâìÁÆóÂë®Êú´ÂéªÊπñËæπÈíìÈ±º„ÄÇ", exPy: "b√† ba d«é su√†n zh≈çu m√≤ q√π h√∫ biƒÅn di√†o y√∫", exEn: "Dad plans to go fishing by the lake this weekend." },
        { word: "ËßÇÈ∏ü", pinyin: "guƒÅn ni«éo", eng: "Birdwatching", emoji: "ü¶ú", exZh: "ËßÇÈ∏üÊó∂‰∏ÄÂÆöË¶Å‰øùÊåÅÂÆâÈùô„ÄÇ", exPy: "guƒÅn ni«éo sh√≠ y√≠ d√¨ng y√†o b«éo ch√≠ ƒÅn j√¨ng", exEn: "You must keep quiet while birdwatching." },
        { word: "Êí∏Áå´", pinyin: "l≈´ mƒÅo", eng: "Petting Cats", emoji: "üê±", exZh: "Êí∏Áå´ÊòØÁºìËß£ÂéãÂäõÁöÑÂ•ΩÂäûÊ≥ï„ÄÇ", exPy: "l≈´ mƒÅo sh√¨ hu«én jiƒõ yƒÅ l√¨ de h«éo b√†n f«é", exEn: "Petting cats is a good way to relieve stress." },
        { word: "ÈÅõÁãó", pinyin: "li√π g«íu", eng: "Walking the Dog", emoji: "ü¶Æ", exZh: "‰ªñÊØèÂ§©Êó©ÊôöÈÉΩ‰ºöÂéªÈÅõÁãó„ÄÇ", exPy: "tƒÅ mƒõi tiƒÅn z«éo w«én d≈çu hu√¨ q√π li√π g«íu", exEn: "He goes walking the dog every morning and evening." },
        { word: "ÁúãÁîµÂΩ±", pinyin: "k√†n di√†ny«êng", eng: "Watching Movies", emoji: "üé¨", exZh: "ÊàëÊúÄÂñúÊ¨¢ÁúãÁßëÂπªÁîµÂΩ±„ÄÇ", exPy: "w«í zu√¨ x«ê huƒÅn k√†n kƒì hu√†n di√†n y«êng", exEn: "I like watching sci-fi movies the most." },
        { word: "ÈÄõÂ±ï", pinyin: "gu√†ng zh«én", eng: "Visiting Exhibitions", emoji: "üñºÔ∏è", exZh: "ÁæéÊúØÈ¶ÜÊúÄËøëÊúâÂæàÂ§öÂ•ΩÁöÑÂ±ïËßà„ÄÇ", exPy: "mƒõi sh√π gu«én zu√¨ j√¨n y«íu hƒõn du≈ç h«éo de zh«én l«én", exEn: "There will be good exhibitions at the museum." },
        { word: "Èú≤Ëê•", pinyin: "l√π y√≠ng", eng: "Camping", emoji: "‚õ∫", exZh: "Èú≤Ëê•ËÆ©Êàë‰ª¨ÊÑüÂèóÂ§ßËá™ÁÑ∂„ÄÇ", exPy: "l√π y√≠ng r√†ng w«í men g«én sh√≤u d√† z√¨ r√°n", exEn: "Camping lets us feel nature." },
        { word: "ÂÜô‰ª£Á†Å", pinyin: "xiƒõ d√†im«é", eng: "Coding", emoji: "üíª", exZh: "ÂÜô‰ª£Á†ÅÊòØ‰∏ÄÈ°πÂæàÊúâÊåëÊàòÁöÑÂ∑•‰Ωú„ÄÇ", exPy: "xiƒõ d√†i m«é sh√¨ y√≠ xi√†ng hƒõn y«íu ti«éo zh√†n de g≈çng zu√≤", exEn: "Coding is a very challenging job." },
        { word: "ÂèëÂëÜ", pinyin: "fƒÅdƒÅi", eng: "Spacing out", emoji: "üò∂", exZh: "ÂÅ∂Â∞îÂèëÂëÜÊúâÂä©‰∫éÊÄùËÄÉ„ÄÇ", exPy: "«íu ƒõr fƒÅ dƒÅi y«íu zh√π y√∫ sƒ´ k«éo", exEn: "Spacing out occasionally helps with thinking." },
        { word: "Âî±K", pinyin: "ch√†ng K", eng: "Karaoke", emoji: "üé§", exZh: "ÂéãÂäõÂ§ßÁöÑÊó∂ÂÄôÊàëÊÉ≥ÂéªÂî±K„ÄÇ", exPy: "yƒÅ l√¨ d√† de sh√≠ hou w«í xi«éng q√π ch√†ng K", exEn: "I want to go to Karaoke when stressed." },
        { word: "ÂñùËå∂", pinyin: "hƒì ch√°", eng: "Tea Tasting", emoji: "üçµ", exZh: "ÂñùËå∂ËÉΩËÆ©‰∫∫Èùô‰∏ãÂøÉÊù•„ÄÇ", exPy: "hƒì ch√° n√©ng r√†ng r√©n j√¨ng xi√† xƒ´n l√°i", exEn: "Tea tasting can calm people down." },
        { word: "ÂñùÂíñÂï°", pinyin: "hƒì kƒÅfƒìi", eng: "Coffee Culture", emoji: "‚òï", exZh: "ÂæàÂ§ö‰∫∫ÈÉΩÊúâÂñùÂíñÂï°ÁöÑ‰π†ÊÉØ„ÄÇ", exPy: "hƒõn du≈ç r√©n d≈çu y«íu hƒì kƒÅ fƒìi de x√≠ gu√†n", exEn: "Many people have the habit of drinking coffee." },
        { word: "Êî∂ÈõÜÊâãÂäû", pinyin: "sh≈çuj√≠ sh«íub√†n", eng: "Collecting Figures", emoji: "ü§ñ", exZh: "‰ªñÊî∂ÈõÜÊâãÂäûÂ∑≤Áªè‰∫îÂπ¥‰∫Ü„ÄÇ", exPy: "tƒÅ sh≈çu j√≠ sh«íu b√†n y«ê jƒ´ng w«î ni√°n le", exEn: "He has been collecting figures for five years." },
        { word: "ÊèíËä±", pinyin: "chƒÅhuƒÅ", eng: "Flower Arranging", emoji: "üíê", exZh: "ÊèíËä±ËÉΩËÆ©ÊàøÈó¥ÂèòÂæóÊõ¥Áæé„ÄÇ", exPy: "chƒÅ huƒÅ n√©ng r√†ng f√°ng jiƒÅn bi√†n de g√®ng mƒõi", exEn: "Flower arranging can make a room more beautiful." },
        { word: "Èô∂Ëâ∫", pinyin: "t√°oy√¨", eng: "Pottery", emoji: "üè∫", exZh: "Ëøô‰ª∂‰ΩúÂìÅÊòØ‰ªñ‰∫≤ÊâãÂÅöÁöÑ„ÄÇ", exPy: "zh√® ji√†n zu√≤ p«ên sh√¨ tƒÅ qƒ´n sh«íu zu√≤ de", exEn: "This piece was made by him personally." },
        { word: "Âê¨Èü≥‰πê", pinyin: "tƒ´ng yƒ´nyu√®", eng: "Listening to Music", emoji: "üéµ", exZh: "Âê¨Èü≥‰πêËÉΩËàíÁºìÁ¥ßÂº†ÁöÑÊÉÖÁª™„ÄÇ", exPy: "tƒ´ng yƒ´n yu√® n√©ng sh≈´ hu«én j«ên zhƒÅng de q√≠ng x√π", exEn: "Listening to music can soothe tension." },
        { word: "ÈÄõË°ó", pinyin: "gu√†ngjiƒì", eng: "Shopping", emoji: "üõçÔ∏è", exZh: "Âë®Êú´ÈÄõË°óÁöÑ‰∫∫ÈùûÂ∏∏Â§ö„ÄÇ", exPy: "zh≈çu m√≤ gu√†ng jiƒì de r√©n fƒìi ch√°ng du≈ç", exEn: "There are so many people shopping on weekends." },
        { word: "ÊóÖË°å", pinyin: "l«öx√≠ng", eng: "Traveling", emoji: "‚úàÔ∏è", exZh: "ÊóÖË°åËÆ©ÊàëËÆ§ËØÜ‰∫ÜÊñ∞ÊúãÂèã„ÄÇ", exPy: "l«ö x√≠ng r√†ng w«í r√®n shi le xƒ´n p√©ng you", exEn: "Traveling let me meet new friends." },
        { word: "ËßÇÂâß", pinyin: "guƒÅnj√π", eng: "Theater Going", emoji: "üé≠", exZh: "ÂéªÂâßÈô¢ËßÇÂâßÊòØ‰∏ÄÁßç‰∫´Âèó„ÄÇ", exPy: "q√π j√π yu√†n guƒÅn j√π sh√¨ y√¨ zh«íng xi«éng sh√≤u", exEn: "Theater going is a kind of enjoyment." },
        { word: "ÊäòÁ∫∏", pinyin: "zh√©zh«ê", eng: "Origami", emoji: "ü¶¢", exZh: "‰ªñÊìÖÈïøÁî®ÊäòÁ∫∏ÂÅöÂ∞èÂä®Áâ©„ÄÇ", exPy: "tƒÅ sh√†n ch√°ng y√≤ng zh√© zh«ê zu√≤ xi«éo d√≤ng w√π", exEn: "He is good at making animals with origami." },
        { word: "ÂÜô‰Ωú", pinyin: "xiƒõzu√≤", eng: "Writing", emoji: "‚úçÔ∏è", exZh: "ÂùöÊåÅÂÜô‰ΩúÊòØ‰∏Ä‰∏™Â•Ω‰π†ÊÉØ„ÄÇ", exPy: "jiƒÅn ch√≠ xiƒõ zu√≤ sh√¨ y√≠ g√® h«éo x√≠ gu√†n", exEn: "Keeping on writing is a good habit." },
        { word: "ÁúãÁêÉ", pinyin: "k√†n qi√∫", eng: "Watching Sports", emoji: "üèüÔ∏è", exZh: "ÁúãÁêÉÊó∂Â§ßÂÆ∂ÈÉΩ‰ºöÂ§ßÂ£∞Ê¨¢Âëº„ÄÇ", exPy: "k√†n qi√∫ sh√≠ d√† jiƒÅ d≈çu hu√¨ d√† shƒìng huƒÅn h≈´", exEn: "Everyone cheers loudly when watching sports." }
    ];

    let currentIdx = 0, currentMode = 'learn', score = 0, rushTimer, timeLeft = 15;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playAudioFeedback(type) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        const now = audioCtx.currentTime;
        if (type === 'correct') {
            osc.frequency.setValueAtTime(523, now); osc.frequency.exponentialRampToValueAtTime(1046, now + 0.1);
            gain.gain.setValueAtTime(0.1, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
            osc.start(); osc.stop(now + 0.3);
        } else {
            osc.frequency.setValueAtTime(150, now); osc.frequency.linearRampToValueAtTime(50, now + 0.2);
            gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0.01, now + 0.2);
            osc.start(); osc.stop(now + 0.2);
        }
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = /[\u4e00-\u9fa5]/.test(text) ? 'zh-CN' : 'en-US';
        window.speechSynthesis.speak(msg);
    }

    function generateRubySentence(zh, py) {
        const chars = zh.split('');
        const pinyins = py.split(' ');
        let html = '';
        chars.forEach((char, i) => {
            // Â¶ÇÊûúÊòØÊ†áÁÇπÁ¨¶Âè∑Ôºå‰∏çÈúÄË¶ÅÊãºÈü≥
            if (/[Ôºå„ÄÇÔºÅÔºü„ÄÅ]/.test(char)) {
                html += char;
            } else {
                html += `<ruby>${char}<rt>${pinyins[i] || ''}</rt></ruby>`;
            }
        });
        return html;
    }

    function startMode(m) {
        currentMode = m; score = 0; clearInterval(rushTimer);
        document.querySelectorAll('.mode-view').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.nav-grid button').forEach(b => b.classList.remove('active'));
        if(event) event.target.classList.add('active');

        if(m === 'summary') {
            document.getElementById('summary-container').classList.remove('hidden');
            renderSummary();
        } else if(m === 'quiz' || m === 'timed') {
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('quiz-score-tag').innerText = "SCORE: 0";
            if(m === 'timed') {
                timeLeft = 15;
                rushTimer = setInterval(() => {
                    timeLeft -= 0.1;
                    document.getElementById('quiz-timer-tag').innerText = Math.ceil(timeLeft) + "s";
                    if(timeLeft <= 0) { clearInterval(rushTimer); alert("TIME UP! Score: " + score); startMode('learn'); }
                }, 100);
            } else { document.getElementById('quiz-timer-tag').innerText = ""; }
            nextQ();
        } else {
            document.getElementById('card-container').classList.remove('hidden');
            renderDisplayCard(true);
        }
    }

    function renderDisplayCard(immediate = false) {
        const h = hobbies[currentIdx];
        const card = document.getElementById('display-card');
        if(immediate) { updateCardContent(h); return; }
        card.classList.add('is-switching');
        setTimeout(() => { updateCardContent(h); card.classList.remove('is-switching'); }, 200);
    }

    function updateCardContent(h) {
        let frontHTML = '', speakText = h.word;
        if(currentMode === 'learn') {
            frontHTML = `<div class="emoji-huge">${h.emoji}</div><ruby class="word-ruby">${h.word}<rt>${h.pinyin}</rt></ruby>`;
        } else if(currentMode === 'card-cn') {
            frontHTML = `<div class="word-huge" style="margin-top:10vh">${h.word}</div>`;
        } else if(currentMode === 'card-en') {
            frontHTML = `<div class="word-en-huge">${h.eng}</div>`; speakText = h.eng;
        }
        
        document.getElementById('card-f').innerHTML = frontHTML;
        
        // ÁîüÊàê‰æãÂè• Ruby HTML
        const rubySentence = generateRubySentence(h.exZh, h.exPy);

        document.getElementById('card-b').innerHTML = `
            <div class="emoji-huge" style="font-size:3.5rem; margin-bottom:0;">${h.emoji}</div>
            <ruby class="word-ruby" style="font-size:3.5rem;">${h.word}<rt>${h.pinyin}</rt></ruby>
            <div class="back-eng-title">${h.eng}</div>
            <div class="ex-container">
                <div class="ex-ruby">${rubySentence}</div>
                <div class="ex-en">${h.exEn}</div>
            </div>`;
            
        document.getElementById('progress-tag').innerText = (currentIdx + 1).toString().padStart(2, '0') + "/38";
        speak(speakText);
    }

    function handleCardClick() {
        const card = document.getElementById('display-card');
        if(!card.classList.contains('is-flipped')) {
            card.classList.add('is-flipped'); speak(hobbies[currentIdx].exZh);
        } else {
            card.classList.remove('is-flipped'); currentIdx = (currentIdx + 1) % hobbies.length;
            setTimeout(() => { renderDisplayCard(); }, 300); 
        }
    }

    function renderSummary() {
        document.getElementById('summary-list').innerHTML = hobbies.map(h => `
            <div class="list-item" onclick="speak('${h.word}')">
                <div style="text-align:left"><span style="font-size:1.6rem; font-weight:bold;">${h.emoji} ${h.word}</span></div>
                <div style="color:var(--primary-blue); font-size:1.1rem; font-weight:600;">${h.eng}</div>
            </div>`).join('');
    }

    function nextQ() {
        const h = hobbies[Math.floor(Math.random() * hobbies.length)];
        const isCN = Math.random() > 0.5;
        document.getElementById('quiz-q').innerText = isCN ? h.word : h.eng;
        const correct = isCN ? h.eng : h.word;
        let opts = [correct];
        while(opts.length < 4) {
            let f = hobbies[Math.floor(Math.random() * hobbies.length)][isCN ? 'eng' : 'word'];
            if(!opts.includes(f)) opts.push(f);
        }
        opts.sort(() => Math.random() - 0.5);
        document.getElementById('quiz-opts').innerHTML = opts.map(o => `
            <button class="opt-btn" onclick="checkQuizAnswer(this, '${o}', '${correct}')">${o}</button>`).join('');
    }

    function checkQuizAnswer(btn, selected, correct) {
        const allBtns = document.querySelectorAll('.opt-btn');
        allBtns.forEach(b => b.disabled = true);
        if(selected === correct) {
            playAudioFeedback('correct'); btn.classList.add('correct');
            score += 10; speak(correct); setTimeout(nextQ, 800);
        } else {
            playAudioFeedback('wrong'); btn.classList.add('wrong');
            allBtns.forEach(b => { if(b.innerText === correct) b.classList.add('correct'); });
            score = Math.max(0, score - 5); if(currentMode === 'timed') timeLeft -= 1.5;
            setTimeout(nextQ, 1200);
        }
        document.getElementById('quiz-score-tag').innerText = "SCORE: " + score;
    }

    document.querySelector('.nav-grid button').click();
</script>
</body>
</html>